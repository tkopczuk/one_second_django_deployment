String.prototype.parseColor=function(){var color="#";if(this.slice(0,4)=="rgb("){var cols=this.slice(4,this.length-1).split(",");var i=0;do{color+=parseInt(cols[i]).toColorPart();}while(++i<3);}else{if(this.slice(0,1)=="#"){if(this.length==4){for(var i=1;i<4;i++){color+=(this.charAt(i)+this.charAt(i)).toLowerCase();}}if(this.length==7){color=this.toLowerCase();}}}return(color.length==7?color:(arguments[0]||this));};Element.collectTextNodes=function(element){return $A($(element).childNodes).collect(function(node){return(node.nodeType==3?node.nodeValue:(node.hasChildNodes()?Element.collectTextNodes(node):""));}).flatten().join("");};Element.collectTextNodesIgnoreClass=function(element,className){return $A($(element).childNodes).collect(function(node){return(node.nodeType==3?node.nodeValue:((node.hasChildNodes()&&!Element.hasClassName(node,className))?Element.collectTextNodesIgnoreClass(node,className):""));}).flatten().join("");};Element.setContentZoom=function(element,percent){element=$(element);element.setStyle({fontSize:(percent/100)+"em"});if(Prototype.Browser.WebKit){window.scrollBy(0,0);}return element;};Element.getInlineOpacity=function(element){return $(element).style.opacity||"";};Element.forceRerendering=function(element){try{element=$(element);var n=document.createTextNode(" ");element.appendChild(n);element.removeChild(n);}catch(e){}};var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:Prototype.K,sinoidal:function(pos){return(-Math.cos(pos*Math.PI)/2)+0.5;},reverse:function(pos){return 1-pos;},flicker:function(pos){var pos=((-Math.cos(pos*Math.PI)/4)+0.75)+Math.random()/4;return pos>1?1:pos;},wobble:function(pos){return(-Math.cos(pos*Math.PI*(9*pos))/2)+0.5;},pulse:function(pos,pulses){pulses=pulses||5;return(((pos%(1/pulses))*pulses).round()==0?((pos*pulses*2)-(pos*pulses*2).floor()):1-((pos*pulses*2)-(pos*pulses*2).floor()));},spring:function(pos){return 1-(Math.cos(pos*4.5*Math.PI)*Math.exp(-pos*6));},none:function(pos){return 0;},full:function(pos){return 1;}},DefaultOptions:{duration:1,fps:100,sync:false,from:0,to:1,delay:0,queue:"parallel"},tagifyText:function(element){var tagifyStyle="position:relative";if(Prototype.Browser.IE){tagifyStyle+=";zoom:1";}element=$(element);$A(element.childNodes).each(function(child){if(child.nodeType==3){child.nodeValue.toArray().each(function(character){element.insertBefore(new Element("span",{style:tagifyStyle}).update(character==" "?String.fromCharCode(160):character),child);});Element.remove(child);}});},multiple:function(element,effect){var elements;if(((typeof element=="object")||Object.isFunction(element))&&(element.length)){elements=element;}else{elements=$(element).childNodes;}var options=Object.extend({speed:0.1,delay:0},arguments[2]||{});var masterDelay=options.delay;$A(elements).each(function(element,index){new effect(element,Object.extend(options,{delay:index*options.speed+masterDelay}));});},PAIRS:{"slide":["SlideDown","SlideUp"],"blind":["BlindDown","BlindUp"],"appear":["Appear","Fade"]},toggle:function(element,effect){element=$(element);effect=(effect||"appear").toLowerCase();var options=Object.extend({queue:{position:"end",scope:(element.id||"global"),limit:1}},arguments[2]||{});Effect[element.visible()?Effect.PAIRS[effect][1]:Effect.PAIRS[effect][0]](element,options);}};Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null;},_each:function(iterator){this.effects._each(iterator);},add:function(effect){var timestamp=new Date().getTime();var position=Object.isString(effect.options.queue)?effect.options.queue:effect.options.queue.position;switch(position){case"front":this.effects.findAll(function(e){return e.state=="idle";}).each(function(e){e.startOn+=effect.finishOn;e.finishOn+=effect.finishOn;});break;case"with-last":timestamp=this.effects.pluck("startOn").max()||timestamp;break;case"end":timestamp=this.effects.pluck("finishOn").max()||timestamp;break;}effect.startOn+=timestamp;effect.finishOn+=timestamp;if(!effect.options.queue.limit||(this.effects.length<effect.options.queue.limit)){this.effects.push(effect);}if(!this.interval){this.interval=setInterval(this.loop.bind(this),15);}},remove:function(effect){this.effects=this.effects.reject(function(e){return e==effect;});if(this.effects.length==0){clearInterval(this.interval);this.interval=null;}},loop:function(){var timePos=new Date().getTime();for(var i=0,len=this.effects.length;i<len;i++){this.effects[i]&&this.effects[i].loop(timePos);}}});Effect.Queues={instances:$H(),get:function(queueName){if(!Object.isString(queueName)){return queueName;}return this.instances.get(queueName)||this.instances.set(queueName,new Effect.ScopedQueue());}};Effect.Queue=Effect.Queues.get("global");Effect.Base=Class.create({position:null,start:function(options){function codeForEvent(options,eventName){return((options[eventName+"Internal"]?"this.options."+eventName+"Internal(this);":"")+(options[eventName]?"this.options."+eventName+"(this);":""));}if(options&&options.transition===false){options.transition=Effect.Transitions.linear;}this.options=Object.extend(Object.extend({},Effect.DefaultOptions),options||{});this.currentFrame=0;this.state="idle";this.startOn=this.options.delay*1000;this.finishOn=this.startOn+(this.options.duration*1000);this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;eval("this.render = function(pos){ "+'if (this.state=="idle"){this.state="running";'+codeForEvent(this.options,"beforeSetup")+(this.setup?"this.setup();":"")+codeForEvent(this.options,"afterSetup")+'};if (this.state=="running"){'+"pos=this.options.transition(pos)*"+this.fromToDelta+"+"+this.options.from+";"+"this.position=pos;"+codeForEvent(this.options,"beforeUpdate")+(this.update?"this.update(pos);":"")+codeForEvent(this.options,"afterUpdate")+"}}");this.event("beforeStart");if(!this.options.sync){Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).add(this);}},loop:function(timePos){if(timePos>=this.startOn){if(timePos>=this.finishOn){this.render(1);this.cancel();this.event("beforeFinish");if(this.finish){this.finish();}this.event("afterFinish");return;}var pos=(timePos-this.startOn)/this.totalTime,frame=(pos*this.totalFrames).round();if(frame>this.currentFrame){this.render(pos);this.currentFrame=frame;}}},cancel:function(){if(!this.options.sync){Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).remove(this);}this.state="finished";},event:function(eventName){if(this.options[eventName+"Internal"]){this.options[eventName+"Internal"](this);}if(this.options[eventName]){this.options[eventName](this);}},inspect:function(){var data=$H();for(property in this){if(!Object.isFunction(this[property])){data.set(property,this[property]);}}return"#<Effect:"+data.inspect()+",options:"+$H(this.options).inspect()+">";}});Effect.Parallel=Class.create(Effect.Base,{initialize:function(effects){this.effects=effects||[];this.start(arguments[1]);},update:function(position){this.effects.invoke("render",position);},finish:function(position){this.effects.each(function(effect){effect.render(1);effect.cancel();effect.event("beforeFinish");if(effect.finish){effect.finish(position);}effect.event("afterFinish");});}});Effect.Tween=Class.create(Effect.Base,{initialize:function(object,from,to){object=Object.isString(object)?$(object):object;var args=$A(arguments),method=args.last(),options=args.length==5?args[3]:null;this.method=Object.isFunction(method)?method.bind(object):Object.isFunction(object[method])?object[method].bind(object):function(value){object[method]=value;};this.start(Object.extend({from:from,to:to},options||{}));},update:function(position){this.method(position);}});Effect.Event=Class.create(Effect.Base,{initialize:function(){this.start(Object.extend({duration:0},arguments[0]||{}));},update:Prototype.emptyFunction});Effect.Opacity=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element){throw (Effect._elementDoesNotExistError);}if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout)){this.element.setStyle({zoom:1});}var options=Object.extend({from:this.element.getOpacity()||0,to:1},arguments[1]||{});this.start(options);},update:function(position){this.element.setOpacity(position);}});Effect.Move=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element){throw (Effect._elementDoesNotExistError);}var options=Object.extend({x:0,y:0,mode:"relative"},arguments[1]||{});this.start(options);},setup:function(){this.element.makePositioned();this.originalLeft=parseFloat(this.element.getStyle("left")||"0");this.originalTop=parseFloat(this.element.getStyle("top")||"0");if(this.options.mode=="absolute"){this.options.x=this.options.x-this.originalLeft;this.options.y=this.options.y-this.originalTop;}},update:function(position){this.element.setStyle({left:(this.options.x*position+this.originalLeft).round()+"px",top:(this.options.y*position+this.originalTop).round()+"px"});}});Effect.MoveBy=function(element,toTop,toLeft){return new Effect.Move(element,Object.extend({x:toLeft,y:toTop},arguments[3]||{}));};Effect.Scale=Class.create(Effect.Base,{initialize:function(element,percent){this.element=$(element);if(!this.element){throw (Effect._elementDoesNotExistError);}var options=Object.extend({scaleX:true,scaleY:true,scaleContent:true,scaleFromCenter:false,scaleMode:"box",scaleFrom:100,scaleTo:percent},arguments[2]||{});this.start(options);},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle("position");this.originalStyle={};["top","left","width","height","fontSize"].each(function(k){this.originalStyle[k]=this.element.style[k];}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var fontSize=this.element.getStyle("font-size")||"100%";["em","px","%","pt"].each(function(fontSizeType){if(fontSize.indexOf(fontSizeType)>0){this.fontSize=parseFloat(fontSize);this.fontSizeType=fontSizeType;}}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;if(this.options.scaleMode=="box"){this.dims=[this.element.offsetHeight,this.element.offsetWidth];}if(/^content/.test(this.options.scaleMode)){this.dims=[this.element.scrollHeight,this.element.scrollWidth];}if(!this.dims){this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth];}},update:function(position){var currentScale=(this.options.scaleFrom/100)+(this.factor*position);if(this.options.scaleContent&&this.fontSize){this.element.setStyle({fontSize:this.fontSize*currentScale+this.fontSizeType});}this.setDimensions(this.dims[0]*currentScale,this.dims[1]*currentScale);},finish:function(position){if(this.restoreAfterFinish){this.element.setStyle(this.originalStyle);}},setDimensions:function(height,width){var d={};if(this.options.scaleX){d.width=width.round()+"px";}if(this.options.scaleY){d.height=height.round()+"px";}if(this.options.scaleFromCenter){var topd=(height-this.dims[0])/2;var leftd=(width-this.dims[1])/2;if(this.elementPositioning=="absolute"){if(this.options.scaleY){d.top=this.originalTop-topd+"px";}if(this.options.scaleX){d.left=this.originalLeft-leftd+"px";}}else{if(this.options.scaleY){d.top=-topd+"px";}if(this.options.scaleX){d.left=-leftd+"px";}}}this.element.setStyle(d);}});Effect.Highlight=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element){throw (Effect._elementDoesNotExistError);}var options=Object.extend({startcolor:"#ffff99"},arguments[1]||{});this.start(options);},setup:function(){if(this.element.getStyle("display")=="none"){this.cancel();return;}this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle("background-image");this.element.setStyle({backgroundImage:"none"});}if(!this.options.endcolor){this.options.endcolor=this.element.getStyle("background-color").parseColor("#ffffff");}if(!this.options.restorecolor){this.options.restorecolor=this.element.getStyle("background-color");}this._base=$R(0,2).map(function(i){return parseInt(this.options.startcolor.slice(i*2+1,i*2+3),16);}.bind(this));this._delta=$R(0,2).map(function(i){return parseInt(this.options.endcolor.slice(i*2+1,i*2+3),16)-this._base[i];}.bind(this));},update:function(position){this.element.setStyle({backgroundColor:$R(0,2).inject("#",function(m,v,i){return m+((this._base[i]+(this._delta[i]*position)).round().toColorPart());}.bind(this))});},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}));}});Effect.ScrollTo=function(element){var options=arguments[1]||{},scrollOffsets=document.viewport.getScrollOffsets(),elementOffsets=$(element).cumulativeOffset(),max=(window.height||document.body.scrollHeight)-document.viewport.getHeight();if(options.offset){elementOffsets[1]+=options.offset;}return new Effect.Tween(null,scrollOffsets.top,elementOffsets[1]>max?max:elementOffsets[1],options,function(p){scrollTo(scrollOffsets.left,p.round());});};Effect.Fade=function(element){element=$(element);var oldOpacity=element.getInlineOpacity();var options=Object.extend({from:element.getOpacity()||1,to:0,afterFinishInternal:function(effect){if(effect.options.to!=0){return;}effect.element.hide().setStyle({opacity:oldOpacity});}},arguments[1]||{});return new Effect.Opacity(element,options);};Effect.Appear=function(element){element=$(element);var options=Object.extend({from:(element.getStyle("display")=="none"?0:element.getOpacity()||0),to:1,afterFinishInternal:function(effect){effect.element.forceRerendering();},beforeSetup:function(effect){effect.element.setOpacity(effect.options.from).show();}},arguments[1]||{});return new Effect.Opacity(element,options);};Effect.Puff=function(element){element=$(element);var oldStyle={opacity:element.getInlineOpacity(),position:element.getStyle("position"),top:element.style.top,left:element.style.left,width:element.style.width,height:element.style.height};return new Effect.Parallel([new Effect.Scale(element,200,{sync:true,scaleFromCenter:true,scaleContent:true,restoreAfterFinish:true}),new Effect.Opacity(element,{sync:true,to:0})],Object.extend({duration:1,beforeSetupInternal:function(effect){Position.absolutize(effect.effects[0].element);},afterFinishInternal:function(effect){effect.effects[0].element.hide().setStyle(oldStyle);}},arguments[1]||{}));};Effect.BlindUp=function(element){element=$(element);element.makeClipping();return new Effect.Scale(element,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(effect){effect.element.hide().undoClipping();}},arguments[1]||{}));};Effect.BlindDown=function(element){element=$(element);var elementDimensions=element.getDimensions();return new Effect.Scale(element,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},restoreAfterFinish:true,afterSetup:function(effect){effect.element.makeClipping().setStyle({height:"0px"}).show();},afterFinishInternal:function(effect){effect.element.undoClipping();}},arguments[1]||{}));};Effect.SwitchOff=function(element){element=$(element);var oldOpacity=element.getInlineOpacity();return new Effect.Appear(element,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(effect){new Effect.Scale(effect.element,1,{duration:0.3,scaleFromCenter:true,scaleX:false,scaleContent:false,restoreAfterFinish:true,beforeSetup:function(effect){effect.element.makePositioned().makeClipping();},afterFinishInternal:function(effect){effect.element.hide().undoClipping().undoPositioned().setStyle({opacity:oldOpacity});}});}},arguments[1]||{}));};Effect.DropOut=function(element){element=$(element);var oldStyle={top:element.getStyle("top"),left:element.getStyle("left"),opacity:element.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(element,{x:0,y:100,sync:true}),new Effect.Opacity(element,{sync:true,to:0})],Object.extend({duration:0.5,beforeSetup:function(effect){effect.effects[0].element.makePositioned();},afterFinishInternal:function(effect){effect.effects[0].element.hide().undoPositioned().setStyle(oldStyle);}},arguments[1]||{}));};Effect.Shake=function(element){element=$(element);var options=Object.extend({distance:20,duration:0.5},arguments[1]||{});var distance=parseFloat(options.distance);var split=parseFloat(options.duration)/10;var oldStyle={top:element.getStyle("top"),left:element.getStyle("left")};return new Effect.Move(element,{x:distance,y:0,duration:split,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:-distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:-distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:-distance,y:0,duration:split,afterFinishInternal:function(effect){effect.element.undoPositioned().setStyle(oldStyle);}});}});}});}});}});}});};Effect.SlideDown=function(element){element=$(element).cleanWhitespace();var oldInnerBottom=element.down().getStyle("bottom");var elementDimensions=element.getDimensions();return new Effect.Scale(element,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},restoreAfterFinish:true,afterSetup:function(effect){effect.element.makePositioned();effect.element.down().makePositioned();if(window.opera){effect.element.setStyle({top:""});}effect.element.makeClipping().setStyle({height:"0px"}).show();},afterUpdateInternal:function(effect){effect.element.down().setStyle({bottom:(effect.dims[0]-effect.element.clientHeight)+"px"});},afterFinishInternal:function(effect){effect.element.undoClipping().undoPositioned();effect.element.down().undoPositioned().setStyle({bottom:oldInnerBottom});}},arguments[1]||{}));};Effect.SlideUp=function(element){element=$(element).cleanWhitespace();var oldInnerBottom=element.down().getStyle("bottom");var elementDimensions=element.getDimensions();return new Effect.Scale(element,window.opera?0:1,Object.extend({scaleContent:false,scaleX:false,scaleMode:"box",scaleFrom:100,scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},restoreAfterFinish:true,afterSetup:function(effect){effect.element.makePositioned();effect.element.down().makePositioned();if(window.opera){effect.element.setStyle({top:""});}effect.element.makeClipping().show();},afterUpdateInternal:function(effect){effect.element.down().setStyle({bottom:(effect.dims[0]-effect.element.clientHeight)+"px"});},afterFinishInternal:function(effect){effect.element.hide().undoClipping().undoPositioned();effect.element.down().undoPositioned().setStyle({bottom:oldInnerBottom});}},arguments[1]||{}));};Effect.Squish=function(element){return new Effect.Scale(element,window.opera?1:0,{restoreAfterFinish:true,beforeSetup:function(effect){effect.element.makeClipping();},afterFinishInternal:function(effect){effect.element.hide().undoClipping();}});};Effect.Grow=function(element){element=$(element);var options=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{});var oldStyle={top:element.style.top,left:element.style.left,height:element.style.height,width:element.style.width,opacity:element.getInlineOpacity()};var dims=element.getDimensions();var initialMoveX,initialMoveY;var moveX,moveY;switch(options.direction){case"top-left":initialMoveX=initialMoveY=moveX=moveY=0;break;case"top-right":initialMoveX=dims.width;initialMoveY=moveY=0;moveX=-dims.width;break;case"bottom-left":initialMoveX=moveX=0;initialMoveY=dims.height;moveY=-dims.height;break;case"bottom-right":initialMoveX=dims.width;initialMoveY=dims.height;moveX=-dims.width;moveY=-dims.height;break;case"center":initialMoveX=dims.width/2;initialMoveY=dims.height/2;moveX=-dims.width/2;moveY=-dims.height/2;break;}return new Effect.Move(element,{x:initialMoveX,y:initialMoveY,duration:0.01,beforeSetup:function(effect){effect.element.hide().makeClipping().makePositioned();},afterFinishInternal:function(effect){new Effect.Parallel([new Effect.Opacity(effect.element,{sync:true,to:1,from:0,transition:options.opacityTransition}),new Effect.Move(effect.element,{x:moveX,y:moveY,sync:true,transition:options.moveTransition}),new Effect.Scale(effect.element,100,{scaleMode:{originalHeight:dims.height,originalWidth:dims.width},sync:true,scaleFrom:window.opera?1:0,transition:options.scaleTransition,restoreAfterFinish:true})],Object.extend({beforeSetup:function(effect){effect.effects[0].element.setStyle({height:"0px"}).show();},afterFinishInternal:function(effect){effect.effects[0].element.undoClipping().undoPositioned().setStyle(oldStyle);}},options));}});};Effect.Shrink=function(element){element=$(element);var options=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},arguments[1]||{});var oldStyle={top:element.style.top,left:element.style.left,height:element.style.height,width:element.style.width,opacity:element.getInlineOpacity()};var dims=element.getDimensions();var moveX,moveY;switch(options.direction){case"top-left":moveX=moveY=0;break;case"top-right":moveX=dims.width;moveY=0;break;case"bottom-left":moveX=0;moveY=dims.height;break;case"bottom-right":moveX=dims.width;moveY=dims.height;break;case"center":moveX=dims.width/2;moveY=dims.height/2;break;}return new Effect.Parallel([new Effect.Opacity(element,{sync:true,to:0,from:1,transition:options.opacityTransition}),new Effect.Scale(element,window.opera?1:0,{sync:true,transition:options.scaleTransition,restoreAfterFinish:true}),new Effect.Move(element,{x:moveX,y:moveY,sync:true,transition:options.moveTransition})],Object.extend({beforeStartInternal:function(effect){effect.effects[0].element.makePositioned().makeClipping();},afterFinishInternal:function(effect){effect.effects[0].element.hide().undoClipping().undoPositioned().setStyle(oldStyle);}},options));};Effect.Pulsate=function(element){element=$(element);var options=arguments[1]||{};var oldOpacity=element.getInlineOpacity();var transition=options.transition||Effect.Transitions.sinoidal;var reverser=function(pos){return transition(1-Effect.Transitions.pulse(pos,options.pulses));};reverser.bind(transition);return new Effect.Opacity(element,Object.extend(Object.extend({duration:2,from:0,afterFinishInternal:function(effect){effect.element.setStyle({opacity:oldOpacity});}},options),{transition:reverser}));};Effect.Fold=function(element){element=$(element);var oldStyle={top:element.style.top,left:element.style.left,width:element.style.width,height:element.style.height};element.makeClipping();return new Effect.Scale(element,5,Object.extend({scaleContent:false,scaleX:false,afterFinishInternal:function(effect){new Effect.Scale(element,1,{scaleContent:false,scaleY:false,afterFinishInternal:function(effect){effect.element.hide().undoClipping().setStyle(oldStyle);}});}},arguments[1]||{}));};Effect.Morph=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element){throw (Effect._elementDoesNotExistError);}var options=Object.extend({style:{}},arguments[1]||{});if(!Object.isString(options.style)){this.style=$H(options.style);}else{if(options.style.include(":")){this.style=options.style.parseStyle();}else{this.element.addClassName(options.style);this.style=$H(this.element.getStyles());this.element.removeClassName(options.style);var css=this.element.getStyles();this.style=this.style.reject(function(style){return style.value==css[style.key];});options.afterFinishInternal=function(effect){effect.element.addClassName(effect.options.style);effect.transforms.each(function(transform){effect.element.style[transform.style]="";});};}}this.start(options);},setup:function(){function parseColor(color){if(!color||["rgba(0, 0, 0, 0)","transparent"].include(color)){color="#ffffff";}color=color.parseColor();return $R(0,2).map(function(i){return parseInt(color.slice(i*2+1,i*2+3),16);});}this.transforms=this.style.map(function(pair){var property=pair[0],value=pair[1],unit=null;if(value.parseColor("#zzzzzz")!="#zzzzzz"){value=value.parseColor();unit="color";}else{if(property=="opacity"){value=parseFloat(value);if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout)){this.element.setStyle({zoom:1});}}else{if(Element.CSS_LENGTH.test(value)){var components=value.match(/^([\+\-]?[0-9\.]+)(.*)$/);value=parseFloat(components[1]);unit=(components.length==3)?components[2]:null;}}}var originalValue=this.element.getStyle(property);return{style:property.camelize(),originalValue:unit=="color"?parseColor(originalValue):parseFloat(originalValue||0),targetValue:unit=="color"?parseColor(value):value,unit:unit};}.bind(this)).reject(function(transform){return((transform.originalValue==transform.targetValue)||(transform.unit!="color"&&(isNaN(transform.originalValue)||isNaN(transform.targetValue))));});},update:function(position){var style={},transform,i=this.transforms.length;while(i--){style[(transform=this.transforms[i]).style]=transform.unit=="color"?"#"+(Math.round(transform.originalValue[0]+(transform.targetValue[0]-transform.originalValue[0])*position)).toColorPart()+(Math.round(transform.originalValue[1]+(transform.targetValue[1]-transform.originalValue[1])*position)).toColorPart()+(Math.round(transform.originalValue[2]+(transform.targetValue[2]-transform.originalValue[2])*position)).toColorPart():(transform.originalValue+(transform.targetValue-transform.originalValue)*position).toFixed(3)+(transform.unit===null?"":transform.unit);}this.element.setStyle(style,true);}});Effect.Transform=Class.create({initialize:function(tracks){this.tracks=[];this.options=arguments[1]||{};this.addTracks(tracks);},addTracks:function(tracks){tracks.each(function(track){track=$H(track);var data=track.values().first();this.tracks.push($H({ids:track.keys().first(),effect:Effect.Morph,options:{style:data}}));}.bind(this));return this;},play:function(){return new Effect.Parallel(this.tracks.map(function(track){var ids=track.get("ids"),effect=track.get("effect"),options=track.get("options");var elements=[$(ids)||$$(ids)].flatten();return elements.map(function(e){return new effect(e,Object.extend({sync:true},options));});}).flatten(),this.options);}});Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle "+"borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth "+"borderRightColor borderRightStyle borderRightWidth borderSpacing "+"borderTopColor borderTopStyle borderTopWidth bottom clip color "+"fontSize fontWeight height left letterSpacing lineHeight "+"marginBottom marginLeft marginRight marginTop markerOffset maxHeight "+"maxWidth minHeight minWidth opacity outlineColor outlineOffset "+"outlineWidth paddingBottom paddingLeft paddingRight paddingTop "+"right textIndent top width wordSpacing zIndex");Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement("div");String.prototype.parseStyle=function(){var style,styleRules=$H();if(Prototype.Browser.WebKit){style=new Element("div",{style:this}).style;}else{String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>';style=String.__parseStyleElement.childNodes[0].style;}Element.CSS_PROPERTIES.each(function(property){if(style[property]){styleRules.set(property,style[property]);}});if(Prototype.Browser.IE&&this.include("opacity")){styleRules.set("opacity",this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]);}return styleRules;};if(document.defaultView&&document.defaultView.getComputedStyle){Element.getStyles=function(element){var css=document.defaultView.getComputedStyle($(element),null);return Element.CSS_PROPERTIES.inject({},function(styles,property){styles[property]=css[property];return styles;});};}else{Element.getStyles=function(element){element=$(element);var css=element.currentStyle,styles;styles=Element.CSS_PROPERTIES.inject({},function(results,property){results[property]=css[property];return results;});if(!styles.opacity){styles.opacity=element.getOpacity();}return styles;};}Effect.Methods={morph:function(element,style){element=$(element);new Effect.Morph(element,Object.extend({style:style},arguments[2]||{}));return element;},visualEffect:function(element,effect,options){element=$(element);var s=effect.dasherize().camelize(),klass=s.charAt(0).toUpperCase()+s.substring(1);new Effect[klass](element,options);return element;},highlight:function(element,options){element=$(element);new Effect.Highlight(element,options);return element;}};$w("fade appear grow shrink fold blindUp blindDown slideUp slideDown "+"pulsate shake puff squish switchOff dropOut").each(function(effect){Effect.Methods[effect]=function(element,options){element=$(element);Effect[effect.charAt(0).toUpperCase()+effect.substring(1)](element,options);return element;};});$w("getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles").each(function(f){Effect.Methods[f]=Element[f];});Element.addMethods(Effect.Methods);Effect.Scroll=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);var options=Object.extend({x:0,y:0,mode:"absolute"},arguments[1]||{});this.start(options);},setup:function(){if(this.options.continuous&&!this.element._ext){this.element.cleanWhitespace();this.element._ext=true;this.element.appendChild(this.element.firstChild);}this.originalLeft=this.element.scrollLeft;this.originalTop=this.element.scrollTop;if(this.options.mode=="absolute"){this.options.x-=this.originalLeft;this.options.y-=this.originalTop;}else{}},update:function(position){this.element.scrollLeft=this.options.x*position+this.originalLeft;this.element.scrollTop=this.options.y*position+this.originalTop;}});(function(){function l(p,n){var q=this,o;q.element=typeof p=="object"?p:document.getElementById(p);q.wrapper=q.element.parentNode;q.element.style.webkitTransitionProperty="-webkit-transform";q.element.style.webkitTransitionTimingFunction="cubic-bezier(0,0,0.25,1)";q.element.style.webkitTransitionDuration="0";q.element.style.webkitTransform=j+"0,0"+b;q.options={bounce:f,momentum:f,checkDOMChanges:true,topOnDOMChanges:false,hScrollbar:f,vScrollbar:f,fadeScrollbar:c||d||!a,shrinkScrollbar:c||d||!a,desktopCompatibility:false,overflow:"hidden",snap:false};if(typeof n=="object"){for(o in n){q.options[o]=n[o];}}if(q.options.desktopCompatibility){q.options.overflow="hidden";}q.wrapper.style.overflow=q.options.overflow;q.refresh();window.addEventListener("onorientationchange" in window?"orientationchange":"resize",q,false);if(a||q.options.desktopCompatibility){q.element.addEventListener(h,q,false);q.element.addEventListener(k,q,false);q.element.addEventListener(g,q,false);}if(q.options.checkDOMChanges){q.element.addEventListener("DOMSubtreeModified",q,false);}}l.prototype={x:0,y:0,enabled:true,handleEvent:function(o){var n=this;switch(o.type){case h:n.touchStart(o);break;case k:n.touchMove(o);break;case g:n.touchEnd(o);break;case"webkitTransitionEnd":n.transitionEnd();break;case"orientationchange":case"resize":n.refresh();break;case"DOMSubtreeModified":n.onDOMModified(o);break;}},onDOMModified:function(o){var n=this;if(o.target.parentNode!=n.element){return;}setTimeout(function(){n.refresh();},0);if(n.options.topOnDOMChanges&&(n.x!=0||n.y!=0)){n.scrollTo(0,0,"0");}},refresh:function(){var o=this,q=this.x,p=this.y,n;o.scrollWidth=o.wrapper.clientWidth;o.scrollHeight=o.wrapper.clientHeight;o.scrollerWidth=o.element.offsetWidth;o.scrollerHeight=o.element.offsetHeight;o.maxScrollX=o.scrollWidth-o.scrollerWidth;o.maxScrollY=o.scrollHeight-o.scrollerHeight;o.directionX=0;o.directionY=0;if(o.scrollX){if(o.maxScrollX>=0){q=0;}else{if(o.x<o.maxScrollX){q=o.maxScrollX;}}}if(o.scrollY){if(o.maxScrollY>=0){p=0;}else{if(o.y<o.maxScrollY){p=o.maxScrollY;}}}if(o.options.snap){o.maxPageX=-Math.floor(o.maxScrollX/o.scrollWidth);o.maxPageY=-Math.floor(o.maxScrollY/o.scrollHeight);n=o.snap(q,p);q=n.x;p=n.y;}if(q!=o.x||p!=o.y){o.setTransitionTime("0");o.setPosition(q,p,true);}o.scrollX=o.scrollerWidth>o.scrollWidth;o.scrollY=!o.scrollX||o.scrollerHeight>o.scrollHeight;if(o.options.hScrollbar&&o.scrollX){o.scrollBarX=o.scrollBarX||new m("horizontal",o.wrapper,o.options.fadeScrollbar,o.options.shrinkScrollbar);o.scrollBarX.init(o.scrollWidth,o.scrollerWidth);}else{if(o.scrollBarX){o.scrollBarX=o.scrollBarX.remove();}}if(o.options.vScrollbar&&o.scrollY&&o.scrollerHeight>o.scrollHeight){o.scrollBarY=o.scrollBarY||new m("vertical",o.wrapper,o.options.fadeScrollbar,o.options.shrinkScrollbar);o.scrollBarY.init(o.scrollHeight,o.scrollerHeight);}else{if(o.scrollBarY){o.scrollBarY=o.scrollBarY.remove();}}},setPosition:function(n,q,p){var o=this;o.x=n;o.y=q;o.element.style.webkitTransform=j+o.x+"px,"+o.y+"px"+b;if(!p){if(o.scrollBarX){o.scrollBarX.setPosition(o.x);}if(o.scrollBarY){o.scrollBarY.setPosition(o.y);}}},setTransitionTime:function(o){var n=this;o=o||"0";n.element.style.webkitTransitionDuration=o;if(n.scrollBarX){n.scrollBarX.bar.style.webkitTransitionDuration=o;n.scrollBarX.wrapper.style.webkitTransitionDuration=f&&n.options.fadeScrollbar?"300ms":"0";}if(n.scrollBarY){n.scrollBarY.bar.style.webkitTransitionDuration=o;n.scrollBarY.wrapper.style.webkitTransitionDuration=f&&n.options.fadeScrollbar?"300ms":"0";}},touchStart:function(p){var o=this,n;p.preventDefault();p.stopPropagation();if(!o.enabled){return;}o.scrolling=true;o.moved=false;o.dist=0;o.setTransitionTime("0");if(o.options.momentum||o.options.snap){n=new WebKitCSSMatrix(window.getComputedStyle(o.element).webkitTransform);if(n.e!=o.x||n.f!=o.y){document.removeEventListener("webkitTransitionEnd",o,false);o.setPosition(n.e,n.f);o.moved=true;}}o.touchStartX=a?p.changedTouches[0].pageX:p.pageX;o.scrollStartX=o.x;o.touchStartY=a?p.changedTouches[0].pageY:p.pageY;o.scrollStartY=o.y;o.scrollStartTime=p.timeStamp;o.directionX=0;o.directionY=0;},touchMove:function(t){var r=this,q=a?t.changedTouches[0].pageX:t.pageX,p=a?t.changedTouches[0].pageY:t.pageY,o=r.scrollX?q-r.touchStartX:0,n=r.scrollY?p-r.touchStartY:0,u=r.x+o,s=r.y+n;if(!r.scrolling){return;}t.stopPropagation();r.touchStartX=q;r.touchStartY=p;if(u>=0||u<r.maxScrollX){u=r.options.bounce?Math.round(r.x+o/3):(u>=0||r.maxScrollX>=0)?0:r.maxScrollX;}if(s>=0||s<r.maxScrollY){s=r.options.bounce?Math.round(r.y+n/3):(s>=0||r.maxScrollY>=0)?0:r.maxScrollY;}if(r.dist>5){r.setPosition(u,s);r.moved=true;r.directionX=o>0?-1:1;r.directionY=n>0?-1:1;}else{r.dist+=Math.abs(o)+Math.abs(n);}},touchEnd:function(v){var u=this,q=v.timeStamp-u.scrollStartTime,y=a?v.changedTouches[0]:v,w,x,p,n,o=0,t=u.x,s=u.y,r;if(!u.scrolling){return;}u.scrolling=false;if(!u.moved){u.resetPosition();if(a){w=y.target;while(w.nodeType!=1){w=w.parentNode;}w.style.pointerEvents="auto";x=document.createEvent("MouseEvents");x.initMouseEvent("click",true,true,v.view,1,y.screenX,y.screenY,y.clientX,y.clientY,v.ctrlKey,v.altKey,v.shiftKey,v.metaKey,0,null);x._fake=true;w.dispatchEvent(x);}return;}if(!u.options.snap&&q>250){u.resetPosition();return;}if(u.options.momentum){p=u.scrollX===true?u.momentum(u.x-u.scrollStartX,q,u.options.bounce?-u.x+u.scrollWidth/5:-u.x,u.options.bounce?u.x+u.scrollerWidth-u.scrollWidth+u.scrollWidth/5:u.x+u.scrollerWidth-u.scrollWidth):{dist:0,time:0};n=u.scrollY===true?u.momentum(u.y-u.scrollStartY,q,u.options.bounce?-u.y+u.scrollHeight/5:-u.y,u.options.bounce?(u.maxScrollY<0?u.y+u.scrollerHeight-u.scrollHeight:0)+u.scrollHeight/5:u.y+u.scrollerHeight-u.scrollHeight):{dist:0,time:0};o=Math.max(Math.max(p.time,n.time),1);t=u.x+p.dist;s=u.y+n.dist;}if(u.options.snap){r=u.snap(t,s);t=r.x;s=r.y;o=Math.max(r.time,o);}u.scrollTo(t,s,o+"ms");},transitionEnd:function(){var n=this;document.removeEventListener("webkitTransitionEnd",n,false);n.resetPosition();},resetPosition:function(){var n=this,p=n.x,o=n.y;if(n.x>=0){p=0;}else{if(n.x<n.maxScrollX){p=n.maxScrollX;}}if(n.y>=0||n.maxScrollY>0){o=0;}else{if(n.y<n.maxScrollY){o=n.maxScrollY;}}if(p!=n.x||o!=n.y){n.scrollTo(p,o);}else{if(n.moved){n.onScrollEnd();n.moved=false;}if(n.scrollBarX){n.scrollBarX.hide();}if(n.scrollBarY){n.scrollBarY.hide();}}},snap:function(n,q){var o=this,p;if(o.directionX>0){n=Math.floor(n/o.scrollWidth);}else{if(o.directionX<0){n=Math.ceil(n/o.scrollWidth);}else{n=Math.round(n/o.scrollWidth);}}o.pageX=-n;n=n*o.scrollWidth;if(n>0){n=o.pageX=0;}else{if(n<o.maxScrollX){o.pageX=o.maxPageX;n=o.maxScrollX;}}if(o.directionY>0){q=Math.floor(q/o.scrollHeight);}else{if(o.directionY<0){q=Math.ceil(q/o.scrollHeight);}else{q=Math.round(q/o.scrollHeight);}}o.pageY=-q;q=q*o.scrollHeight;if(q>0){q=o.pageY=0;}else{if(q<o.maxScrollY){o.pageY=o.maxPageY;q=o.maxScrollY;}}p=Math.round(Math.max(Math.abs(o.x-n)/o.scrollWidth*500,Math.abs(o.y-q)/o.scrollHeight*500));return{x:n,y:q,time:p};},scrollTo:function(o,n,q){var p=this;if(p.x==o&&p.y==n){p.resetPosition();return;}p.moved=true;p.setTransitionTime(q||"350ms");p.setPosition(o,n);if(q==="0"||q=="0s"||q=="0ms"){p.resetPosition();}else{document.addEventListener("webkitTransitionEnd",p,false);}},scrollToPage:function(p,o,r){var q=this,n;if(!q.options.snap){q.pageX=-Math.round(q.x/q.scrollWidth);q.pageY=-Math.round(q.y/q.scrollHeight);}if(p=="next"){p=++q.pageX;}else{if(p=="prev"){p=--q.pageX;}}if(o=="next"){o=++q.pageY;}else{if(o=="prev"){o=--q.pageY;}}p=-p*q.scrollWidth;o=-o*q.scrollHeight;n=q.snap(p,o);p=n.x;o=n.y;q.scrollTo(p,o,r||"500ms");},scrollToElement:function(o,q){o=typeof o=="object"?o:this.element.querySelector(o);if(!o){return;}var p=this,n=p.scrollX?-o.offsetLeft:0,r=p.scrollY?-o.offsetTop:0;if(n>=0){n=0;}else{if(n<p.maxScrollX){n=p.maxScrollX;}}if(r>=0){r=0;}else{if(r<p.maxScrollY){r=p.maxScrollY;}}p.scrollTo(n,r,q);},momentum:function(u,o,s,n){var r=2.5,t=1.2,p=Math.abs(u)/o*1000,q=p*p/r/1000,v=0;if(u>0&&q>s){p=p*s/q/r;q=s;}else{if(u<0&&q>n){p=p*n/q/r;q=n;}}q=q*(u<0?-1:1);v=p/t;return{dist:Math.round(q),time:Math.round(v)};},onScrollEnd:function(){},destroy:function(n){var o=this;window.removeEventListener("onorientationchange" in window?"orientationchange":"resize",o,false);o.element.removeEventListener(h,o,false);o.element.removeEventListener(k,o,false);o.element.removeEventListener(g,o,false);document.removeEventListener("webkitTransitionEnd",o,false);if(o.options.checkDOMChanges){o.element.removeEventListener("DOMSubtreeModified",o,false);}if(o.scrollBarX){o.scrollBarX=o.scrollBarX.remove();}if(o.scrollBarY){o.scrollBarY=o.scrollBarY.remove();}if(n){o.wrapper.parentNode.removeChild(o.wrapper);}return null;}};function m(n,s,r,o){var q=this,p;q.dir=n;q.fade=r;q.shrink=o;q.uid=++e;q.bar=document.createElement("div");p="position:absolute;top:0;left:0;-webkit-transition-timing-function:cubic-bezier(0,0,0.25,1);pointer-events:none;-webkit-transition-duration:0;-webkit-transition-delay:0;-webkit-transition-property:-webkit-transform;z-index:10;background:rgba(0,0,0,0.5);-webkit-transform:"+j+"0,0"+b+";"+(n=="horizontal"?"-webkit-border-radius:3px 2px;min-width:6px;min-height:5px":"-webkit-border-radius:2px 3px;min-width:5px;min-height:6px");q.bar.setAttribute("style",p);q.wrapper=document.createElement("div");p="-webkit-mask:-webkit-canvas(scrollbar"+q.uid+q.dir+");position:absolute;z-index:10;pointer-events:none;overflow:hidden;opacity:0;-webkit-transition-duration:"+(r?"300ms":"0")+";-webkit-transition-delay:0;-webkit-transition-property:opacity;"+(q.dir=="horizontal"?"bottom:2px;left:2px;right:7px;height:5px":"top:2px;right:2px;bottom:7px;width:5px;");q.wrapper.setAttribute("style",p);q.wrapper.appendChild(q.bar);s.appendChild(q.wrapper);}m.prototype={init:function(n,p){var q=this,o;if(q.dir=="horizontal"){if(q.maxSize!=q.wrapper.offsetWidth){q.maxSize=q.wrapper.offsetWidth;o=document.getCSSCanvasContext("2d","scrollbar"+q.uid+q.dir,q.maxSize,5);o.fillStyle="rgb(0,0,0)";o.beginPath();o.arc(2.5,2.5,2.5,Math.PI/2,-Math.PI/2,false);o.lineTo(q.maxSize-2.5,0);o.arc(q.maxSize-2.5,2.5,2.5,-Math.PI/2,Math.PI/2,false);o.closePath();o.fill();}}else{if(q.maxSize!=q.wrapper.offsetHeight){q.maxSize=q.wrapper.offsetHeight;o=document.getCSSCanvasContext("2d","scrollbar"+q.uid+q.dir,5,q.maxSize);o.fillStyle="rgb(0,0,0)";o.beginPath();o.arc(2.5,2.5,2.5,Math.PI,0,false);o.lineTo(5,q.maxSize-2.5);o.arc(2.5,q.maxSize-2.5,2.5,0,Math.PI,false);o.closePath();o.fill();}}q.size=Math.max(Math.round(q.maxSize*q.maxSize/p),6);q.maxScroll=q.maxSize-q.size;q.toWrapperProp=q.maxScroll/(n-p);q.bar.style[q.dir=="horizontal"?"width":"height"]=q.size+"px";},setPosition:function(o){var n=this;if(n.wrapper.style.opacity!="1"){n.show();}o=Math.round(n.toWrapperProp*o);if(o<0){o=n.shrink?o+o*3:0;if(n.size+o<7){o=-n.size+6;}}else{if(o>n.maxScroll){o=n.shrink?o+(o-n.maxScroll)*3:n.maxScroll;if(n.size+n.maxScroll-o<7){o=n.size+n.maxScroll-6;}}}o=n.dir=="horizontal"?j+o+"px,0"+b:j+"0,"+o+"px"+b;n.bar.style.webkitTransform=o;},show:function(){if(f){this.wrapper.style.webkitTransitionDelay="0";}this.wrapper.style.opacity="1";},hide:function(){if(f){this.wrapper.style.webkitTransitionDelay="350ms";}this.wrapper.style.opacity="0";},remove:function(){this.wrapper.parentNode.removeChild(this.wrapper);return null;}};var f=("WebKitCSSMatrix" in window&&"m11" in new WebKitCSSMatrix()),c=(/iphone/gi).test(navigator.appVersion),d=(/ipad/gi).test(navigator.appVersion),i=(/android/gi).test(navigator.appVersion),a=c||d||i,h=a?"touchstart":"mousedown",k=a?"touchmove":"mousemove",g=a?"touchend":"mouseup",j="translate"+(f?"3d(":"("),b=f?",0)":")",e=0;window.iScroll=l;})();NYTD.MOTH=function(mothContainerId,visibleAtOnce,scrollIncrementAmount,alternateImageSource){if(window.browser&&(window.browser instanceof InsideNYTimesBrowser)){return;}var totalColumns,imagesLoaded=false,firstRowCells=$$("#"+mothContainerId+" tr:first-child td"),allCells=$$("#"+mothContainerId+" td");var itemIndex=0;var imgSrc=alternateImageSource||"http://graphics8.nytimes.com/images/global/buttons/";var distance=$$("#insideNYTimesBrowser td").first().offsetWidth+1;var images={leftOff:"moth_reverse_off.gif",leftOn:"moth_reverse.gif",rightOff:"moth_forward_off.gif",rightOn:"moth_forward.gif"};var isTouch=(typeof document.ontouchmove=="object")||location.hash.indexOf("isTouch")>0;this.load=function(){allCells.invoke("removeClassName","hidden");totalColumns=firstRowCells.length;if(isTouch){this.addSwipe();}else{this.activateButtons();this.showButtons();}$("insideNYTimesScrollWrapper").scrollLeft=0;};function tooFarRight(){return itemIndex+visibleAtOnce>=totalColumns;}function tooFarLeft(){return itemIndex==0;}function loadUnloadedImages(){if(imagesLoaded){return;}$$("#"+mothContainerId+" td").each(function(td){var span=td.select("span.img[src]")[0];if(span){var image=new Element("img",{src:span.getAttribute("src"),alt:span.getAttribute("alt"),height:span.getAttribute("height"),width:span.getAttribute("width")});span.up("a").insert(image);}if(isTouch){td.removeClassName("hidden");}});imagesLoaded=true;}this.activateButtons=function(){var reverse=$("mothReverse"),forward=$("mothForward");if(reverse&&forward){reverse.observe("click",this.goLeft.bind(this));forward.observe("click",this.goRight.bind(this));}};this.disableButtons=function(){var reverse=$("mothReverse"),forward=$("mothForward");if(reverse&&forward){reverse.stopObserving("click");forward.stopObserving("click");}};this.showButtons=function(){var reverse=$("mothReverse"),forward=$("mothForward");if(reverse&&forward){reverse.src=tooFarLeft()?imgSrc+images.leftOff:imgSrc+images.leftOn;forward.src=tooFarRight()?imgSrc+images.rightOff:imgSrc+images.rightOn;}};this.goRight=function(){if(tooFarRight()){return;}this.disableButtons();itemIndex+=scrollIncrementAmount;this.update("right");};this.goLeft=function(){if(tooFarLeft()){return;}this.disableButtons();itemIndex-=scrollIncrementAmount;this.update("left");};this.update=function(direction){loadUnloadedImages();var incrementAmount=(direction=="right")?distance:-distance;var that=this;new Effect.Scroll($("insideNYTimesScrollWrapper"),{x:incrementAmount,y:0,mode:"relative",duration:0.4,afterFinish:function(){that.activateButtons();}});this.showButtons();};this.addSwipe=function(){var nav=$("insideNYTimesHeader").select(".navigation")[0];if(nav){nav.remove();}var moth=$(mothContainerId);moth.style.width=moth.getWidth()+"px";loadUnloadedImages();var sc=new iScroll(mothContainerId,{scrollbarClass:"mothTouchScroll",vScrollBar:false,hScrollBar:true,checkDOMChanges:false});};};Event.observe(window,"load",function(){var insideNYT=$("insideNYTimesBrowser");if(insideNYT){var count=insideNYT.down(1).select("td").select(function(cell){return cell.getStyle("display")!="none";}).length;var moth=new NYTD.MOTH("insideNYTimesBrowser",count,1).load();}});(function(){var Wire={init:function(){this.est=this.checkTimeZone();this.element=$("wireContent");if(this.element){this.timestamps=this.element.select("li span");this.updateTimesStamps();new PeriodicalExecuter(this.updateTimesStamps.bind(this),30);}},checkTimeZone:function(){var n=new Date();var d1=new Date(n.getFullYear(),0,1,0,0,0,0);var d2=new Date(n.getFullYear(),6,1,0,0,0,0);var tm=d1.toGMTString();var d3=new Date(tm.substring(0,tm.lastIndexOf(" ")-1));var tm=d2.toGMTString();var d4=new Date(tm.substring(0,tm.lastIndexOf(" ")-1));var hDiffStd=(d1-d3)/(1000*60*60);var hDiffDST=(d2-d4)/(1000*60*60);return((n.getTimezoneOffset()/60)+hDiffStd);},updateTimesStamps:function(){for(var i=0,span,gmt;span=this.timestamps[i];++i){gmt=span.getAttribute("data-gmt");if(gmt){span.innerHTML=this.readableTimestampFromGMT(gmt);}else{span.innerHTML=this.readableTimestampFromET(span.title)||span.title;}}},readableTimestampFromGMT:function(gmtTimestamp){var now=+new Date()/1000;gmtTimestamp=parseInt(gmtTimestamp,10);var diff=now-gmtTimestamp;var time=new Date(gmtTimestamp);return this.readableTimestamp(time,diff);},readableTimestampFromET:function(timestamp){var tsFull=this.timestampToDate(timestamp)||0;var now=new Date();now.setHours(now.getHours()+this.est);var dif=(now.getTime()-tsFull.getTime())/1000;return this.readableTimestamp(tsFull,dif);},readableTimestamp:function(time,diff){switch(true){case (diff<60):return"Moments ago";case (diff<120):return"1 minute ago";case (diff<3600):return Math.round(diff/60)+" minutes ago";break;default:var tsHour=time.getHours();var tsMin=time.getMinutes();tsMin=(tsMin<10)?"0"+tsMin:tsMin;var tsText=((tsHour==0)?"12":((tsHour>12)?(tsHour-12):tsHour))+":"+tsMin+" "+((time.getHours()>11)?"PM":"AM")+" ET";return tsText;}return"";},timestampToDate:function(ts){if(ts!=undefined){return new Date(ts.replace(/-/g,"/"));}else{return new Date();}}};Wire.init();})();ArticleCommentCounts=(function(){var that={};that.apply=function(){getLinkFields().each(addLink);getCountFields().each(addCount);};function getCountFields(){return $$(".commentCountText");}function getLinkFields(){return $$(".commentCountLink");}function addLink(node){var articleId=getArticleId(node);if(nodeIsBlank(node)){if(commentInfoExistsFor(articleId)){addContent(node,getPostCommentLink);addContent(node,getDivider);addContent(node,getReadAllCommentsLink);}else{if(hasOverflowUrlInAttribute(node)){addContent(node,getBailOutPostCommentLink);}}}}function addCount(node){if(nodeIsBlank(node)){addContent(node,getCountNode);}}function getPostCommentLink(data,node){return(data.commentsEnabled)?link(getOverflowUrl(node)+"#postComment","Post a Comment"):emptyNode();}function getBailOutPostCommentLink(data,node){return link(getOverflowUrl(node),"Comments");}function getReadCommentsLinkText(data){return(data.commentsEnabled)?"Read ":"Read Comments ";}function getReadAllCommentsLink(data,node){return hasComments(data)?link(getOverflowUrl(node),getReadCommentsLinkText(data)+getCountText(data)):emptyNode();}function getDivider(data){return(data.commentsEnabled&&hasComments(data))?document.createTextNode(" | "):emptyNode();}function getCountNode(data){return document.createTextNode(getCountText(data));}function getArticleId(node){return node.getAttribute("articleid").strip();}function getCommentData(articleId){if(commentInfoExistsFor(articleId)){return NYTArticleCommentCounts[articleId];}}function commentInfoExistsFor(articleId){return(articleId&&NYTArticleCommentCounts&&NYTArticleCommentCounts[articleId]);}function hasOverflowUrlInAttribute(node){return !!node.getAttribute("overflowurl");}function getOverflowUrl(node){return node.getAttribute("overflowurl");}function getCountText(data){return hasComments(data)?"("+data.count+")":"";}function addContent(parent,childBuilder){var articleId=getArticleId(parent);parent.appendChild(childBuilder(getCommentData(articleId),parent));}function hasComments(data){return typeof data!="undefined"&&typeof data.count!="undefined"&&data.count>0;}function nodeIsBlank(node){return(node.innerHTML=="");}function link(url,text){return new Element("a",{href:url}).update(text);}function emptyNode(){return document.createTextNode("");}return that;})();if(window["console"]===undefined){window.console={log:function(){}};}NYTD.SearchSuggest={config:{SearchForm:"searchForm",Wrapper:"toolbarSearch",SearchInput:"hpSearchQuery",ResultsContainer:"homepageAutosuggest",ActiveSearchClass:"toolbarSearchActive",RemoteAd:"HPSiteSearch",RemoteAdPage:"homepage.nytimes.com/search",ServiceURL:"/suggest",SearchURL:"http://query.nytimes.com/search/sitesearch",SuggestionTemplate:new Template('<li><a href="#{url}?query=#{suggestion_query}" title="#{suggestion_title}">#{suggestion}</a></li>')},initialize:function(){var config=NYTD.SearchSuggest.config;var input=$(config.SearchInput);if(!input){return;}var formElem=document.getElementById(config.SearchForm);formElem.parentNode.innerHTML+='<div id="toolbarAutosuggest" style="display:none"><ul id="toolbarAutosuggestions" class="flush">< /ul></div>';this.searchForm=$(config.SearchForm);this.wrapper=$(config.Wrapper);this.element=$(config.SearchInput);this.container=$("toolbarAutosuggest");this.suggestionsContainer=$("toolbarAutosuggestions");this.suggestionTemplate=config.SuggestionTemplate;this.activeClass=config.ActiveSearchClass;this.url=config.ServiceURL;this.searchURL=config.SearchURL;this.urls=[];this.selectedIndex=null;this.entryCount=4;this.shadow=null;this.adShow=$("toolbarSearchContainer").hasClassName("toolbarSearchContainer-withad");this.adSpot=$(config.RemoteAd);this.element.setAttribute("autocomplete","off");this.searchForm.setAttribute("autocomplete","off");this.element.observe("keydown",this.onKeyPress.bindAsEventListener(this));this.element.observe("blur",this.hide.bindAsEventListener(this));this.searchForm.observe("mousedown",this.raiseSearchDisplay.bindAsEventListener(this));},onKeyPress:function(event){if(!this.wrapper.hasClassName(this.activeClass)){this.raiseSearchDisplay();}switch(event.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.selectEntry(event);case Event.KEY_ESC:this.hide();case 16:case 17:case 18:case 224:case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:case Event.KEY_DOWN:if(this.container.visible()){this.markSelected(event.keyCode==Event.KEY_UP);Event.stop(event);}return;}if(this.observer){clearTimeout(this.observer);}this.observer=setTimeout(this.updateResults.bind(this),10);},onHover:function(event){if(this.selectedIndex!=null){this.suggestionsContainer.childNodes[this.selectedIndex].removeClassName("selected");}var selected=Event.findElement(event,"LI");if(!selected){return;}this.selectedIndex=selected.autocompleteIndex;this.suggestionsContainer.childNodes[this.selectedIndex].addClassName("selected");},onMouseout:function(event){if(this.selectedIndex!=null){this.suggestionsContainer.childNodes[this.selectedIndex].removeClassName("selected");this.selectedIndex=null;}},selectEntry:function(event){if(this.selectedIndex!=null){window.location.href=this.urls[this.selectedIndex];Event.stop(event);}},markSelected:function(markUp){var items=this.suggestionsContainer.select("li");if(this.selectedIndex==null||this.selectedIndex==undefined){this.selectedIndex=0;}else{items[this.selectedIndex].removeClassName("selected");this.selectedIndex=(markUp)?(this.selectedIndex==0)?this.entryCount-1:this.selectedIndex-1:(this.selectedIndex==this.entryCount-1)?0:this.selectedIndex+1;}if(items&&items[this.selectedIndex]!=undefined){items[this.selectedIndex].addClassName("selected");}},show:function(){this.container.appear({duration:0.2});this.showAd();},hide:function(event){var event=event;var that=this;this.selectedIndex=null;if(!this.container.visible()){if(typeof event!="undefined"){this.lowerSearchDisplay();}return;}this.container.fade({duration:0.2,afterFinish:function(){if(typeof event!="undefined"){that.lowerSearchDisplay();}}});this.hideAd();},updateResults:function(){if(this.element.value.length<2){this.hide();return;}new Ajax.Request(this.url,{method:"get",parameters:{query:this.element.value},onComplete:this.buildResults.bind(this),onCreate:this.createLoadingView.bind(this),onSuccess:this.removeLoadingView.bind(this),onFailure:this.removeLoadingView.bind(this)});},createLoadingView:function(){this.element.addClassName("loading");},removeLoadingView:function(){this.element.removeClassName("loading");},refreshAd:function(){if(!this.adShow){return;}var raScript=new Element("script",{"src":"http://www.nytimes.com/adx/bin/adx_remote.html?type=fastscript"+"&page="+this.config.RemoteAdPage+"&posall=HPSiteSearch,ADX_CLIENTSIDE"+"&query=qstring&keywords=?"});$$("head")[0].appendChild(raScript);if(typeof adxpos_HPSiteSearch!="undefined"){this.adSpot.innerHTML=(adxads[adxpos_HPSiteSearch]);}else{var that=this;window.setTimeout(function(){if(typeof adxpos_HPSiteSearch!="undefined"){that.adSpot.innerHTML=(adxads[adxpos_HPSiteSearch]);}},900);}},hideAd:function(){if(!this.adShow){return;}this.adSpot.fade({duration:0.2});},showAd:function(){if(!this.adShow){return;}this.adSpot.appear({duration:0.2});},raiseSearchDisplay:function(){this.wrapper.addClassName(this.activeClass);},lowerSearchDisplay:function(event){this.wrapper.removeClassName(this.activeClass);},buildResults:function(response){var json=response.responseText.evalJSON()||false;if(!json){this.hide();return;}var suggestions=json[0];var suggestionsCount=(suggestions)?suggestions.length:0;if(suggestionsCount>this.entryCount){suggestionsCount=this.entryCount;}if(!suggestions||suggestionsCount==0){this.hide();return;}var re=new RegExp("("+this.element.value+")","i");if(suggestionsCount>0){var html=[];var template=this.suggestionTemplate;var suggestionQuery;this.urls=[];this.selectedIndex==null;this.refreshAd();for(var i=0;i<suggestionsCount;i++){suggestionQuery=encodeURI(suggestions[i]);suqqestionURL=this.searchURL+"?query="+suggestionQuery;this.urls.push(suqqestionURL);html.push(template.evaluate({url:this.searchURL,suggestion_query:suggestionQuery,suggestion_title:suggestions[i],suggestion:suggestions[i].replace(re,"<strong>$1</strong>")}));}this.suggestionsContainer.show().update(html.join(""));var that=this;this.suggestionsContainer.select("a").each(function(link){link.observe("click",function(){that.element.value=link.getAttribute("title");});link.observe("mouseover",function(){this.up("li").addClassName("selected");});link.observe("mouseout",function(){this.up("li").removeClassName("selected");});});}else{this.suggestionsContainer.hide();}this.show();}};NYTD.SearchSuggest.initialize();Event.observe(window,"load",function(){var mobile=new RegExp("nyt-mobile=([^;]+)").test(unescape(document.cookie))?RegExp.$1:null;if(mobile==0){var body=document.getElementsByTagName("body")[0];var ft=document.createElement("div");ft.id="mobileFooter";ft.innerHTML="<span>Go to the NYTimes.com Mobile Site &raquo;</span>";ft.addEventListener("click",function(){document.cookie="nyt-mobile=;path=/;domain=.nytimes.com;expires=Sat, 01-Jan-2000 00:00:00 GMT";window.location="http://mobile.nytimes.com/";},false);body.style.paddingBottom=0;body.appendChild(ft);}});(function(){ArticleCommentCounts.apply();}());