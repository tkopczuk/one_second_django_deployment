NYTD.HomepageRefresh=(function(){var timeoutPeriod=900000;var refresh=function(){var expTime=new Date();expTime.setTime(expTime.getTime()+60000);document.cookie="autorefresh=1; expires="+expTime.toGMTString()+"; path=/";document.location.reload();};var timeoutID,timeoutState,timeoutTime;var doTimerStart=function(){timeoutID=window.setTimeout(refresh,timeoutPeriod);timeoutState="running";var now=(new Date()).getTime();timeoutTime=new Date(now+timeoutPeriod);};var doTimerStop=function(){window.clearTimeout(timeoutID);timeoutID=null;timeoutState="stopped";timeoutTime=0;};doTimerStart();var idCounter=0;var registrants={};var register=function(callerName){var identifier=callerName||"<anonymous>";idCounter++;registrants["id"+idCounter]={name:identifier,started:true};return idCounter;};var stop=function(id){registrants["id"+id].started=false;if(timeoutID!==null){doTimerStop();}};var start=function(id){registrants["id"+id].started=true;if(timeoutID===null){var startTimer=true;for(var prop in registrants){if(registrants.hasOwnProperty(prop)){startTimer=startTimer&&registrants[prop].started;}}if(startTimer){doTimerStart();}}};var dumpState=function(){var now=new Date();if(typeof console!="undefined"&&console.log){console.log("Timer is "+timeoutState+".");if(timeoutTime>0){var diff=timeoutTime.getTime()-now.getTime();diff=Math.floor(diff/1000);var minutes=Math.floor(diff/60);var seconds=diff-(minutes*60);console.log(""+minutes+" minutes, "+seconds+" seconds remaining.");console.log("Approximate refresh time: "+timeoutTime+".");console.log("Current time: "+now);}for(var key in registrants){if(registrants.hasOwnProperty(key)){var id=key.substring("2");var line="ID "+id;if(registrants[key].name!==""){line+=" ("+registrants[key].name+")";}line+=": "+(registrants[key].started?"running":"stopped");console.log(line);}}}};return{register:register,start:start,stop:stop,manualRefresh:refresh,currentStatus:dumpState};})();var pageTimer=(function(){var id=NYTD.HomepageRefresh.register("window.pageTimer");var setToStart=true;var doStart=function(){NYTD.HomepageRefresh.start(id);setToStart=true;};var doStop=function(){NYTD.HomepageRefresh.stop(id);setToStart=false;};return{start:function(){doStart();},stop:function(){doStop();},toggle:function(){if(setToStart){doStop();}else{doStart();}}};})();(function(){function resizeColumns(){function resize(layout){var parentLayout=layout.up(".layout");if(!parentLayout||parentLayout.hasClassName("noBackground")){return;}var parentColumn=layout.up(".column");if(!parentColumn){return;}var targetLayout=parentColumn.childElements().last();if(targetLayout.hasClassName("adjusted")){return;}var delta=parentLayout.getHeight()-parentColumn.getHeight()-parseInt(parentLayout.getStyle("paddingTop"),10)-parseInt(targetLayout.getStyle("paddingTop"),10);if(delta>0){var paddingDiv=new Element("div");parentColumn.appendChild(paddingDiv);paddingDiv.setStyle({"height":delta+"px"}).addClassName("adjusted");}}$$(".aColumn, .bColumn, .abColumn").invoke("addClassName","column");$$(".spanAB, .wideB, .wideA, .subColumn-2").invoke("addClassName","layout").each(resize);}if(window.addEventListener){window.addEventListener("load",resizeColumns,false);}else{if(window.attachEvent){window.attachEvent("onload",resizeColumns);}}})();NYTD.Cookies={getOrCreate:function(cookieName){var cookies=document.cookie.split(";");var nameSearchString=cookieName+"=";var cookieValueString="";for(var c=0,len=cookies.length;c<len;++c){var cur=cookies[c];cur=cur.replace(/^ */,"");if(cur.indexOf(nameSearchString)==0){cookieValueString=cur.substring(nameSearchString.length,cur.length);}}var Cookie=function(name,str){var checkKey="creator";var checkVal="NYTD.Cookies";var cookieName=name;var cookieString=str||"";var keyValPairs={};if(str!=""){var checkStr=checkKey+"|"+checkVal;var regex=new RegExp(checkStr,"g");cookieString.replace(regex,"");var pairs=cookieString.split("^");for(var p=0,len=pairs.length;p<len;++p){var cur=pairs[p];var vals=cur.split("|");keyValPairs[vals[0]]=vals[1];}}var set=function(expirationMillis){var exp=new Date();var expirationOffset=expirationMillis||31536000000;var len=0;var keyvals=[];if(keyValPairs[checkKey]){delete keyValPairs[checkKey];}for(key in keyValPairs){if(keyValPairs.hasOwnProperty(key)){keyvals.push(key+"|"+keyValPairs[key]);len++;}}keyvals.push(checkKey+"|"+checkVal);if(len>0){exp.setTime(exp.getTime()+expirationOffset);}else{exp.setTime(exp.getTime()-86400000);}var expires="; expires="+exp.toGMTString();document.cookie=cookieName+"="+keyvals.join("^")+expires+"; domain=.nytimes.com; path=/";};this.lookup=function(key){return keyValPairs[key];};this.add=function(obj,expiration){for(key in obj){if(obj.hasOwnProperty(key)){keyValPairs[key]=obj[key];}}set(expiration);};this.remove=function(){for(var i=0,arg;arg=arguments[i];++i){if(keyValPairs[arg]){delete keyValPairs[arg];}}set();};};return new Cookie(cookieName,cookieValueString);},cookiesEnabled:function(){var name="NYTCookiesEnabled";var exp=new Date();exp.setTime(exp.getTime()+10000);document.cookie=name+"=test; expires="+exp.toGMTString();var result=(document.cookie.indexOf(name)!==-1);if(result){exp=new Date();exp.setTime(exp.getTime()-10000);document.cookie=name+"=test; expires="+exp.toGMTString();}return result;}};NYTD.BCVideoAsyncManager=(function(){var scriptLoaded=false;var callbacks=[];var register=function(func){if(scriptLoaded){window.setTimeout(func,0);}else{callbacks.push(func);}};var doCallbacks=function(){for(var i=0,len=callbacks.length;i<len;++i){window.setTimeout(callbacks[i],0);}};var scriptElem=document.createElement("script");scriptElem.type="text/javascript";scriptElem.src="http://admin.brightcove.com/js/BrightcoveExperiences_all.js";scriptElem.async=true;scriptElem.onreadystatechange=function(){if(this.readyState=="complete"){scriptLoaded=true;doCallbacks();}};scriptElem.onload=function(e){scriptLoaded=true;doCallbacks();};var s=document.getElementsByTagName("script")[0];window.setTimeout(function(){s.parentNode.insertBefore(scriptElem,s);},1000);return{registerCallback:register};})();NYTD.TimesCastManager=(function(){var bcExperience=null;var videoModule=null;var adModule=null;var midrollAdObj=null;var videoId=0;var videoDate="";var refreshTimerId=NYTD.HomepageRefresh.register("timescast player");var init=function(bcExperience){videoModule=bcExperience.getModule(APIModules.VIDEO_PLAYER);videoModule.addEventListener(BCMediaEvent.BEGIN,function(e){NYTD.HomepageRefresh.stop(refreshTimerId);var adSvcUrl="http://video.nytimes.com/svc/ads/video/SinglePlayerVideoAd.js";var adSvcQuery="callback=NYTD.TimesCastManager.adHandler&pagename=www.nytimes.com/timescastad/video&positions=VideoPlayerAd,ADX_CLIENTSIDE&ver="+Math.random();var scriptElem=document.createElement("script");scriptElem.setAttribute("src",adSvcUrl+"?"+adSvcQuery);scriptElem.setAttribute("type","text/javascript");document.getElementsByTagName("head")[0].appendChild(scriptElem);NYTD.TimesCastManager.Tracking.trackPlay(videoId,videoDate);});videoModule.addEventListener(BCMediaEvent.COMPLETE,function(e){NYTD.HomepageRefresh.start(refreshTimerId);NYTD.TimesCastManager.Tracking.trackStop(videoId,videoDate);});adModule=bcExperience.getModule(APIModules.ADVERTISING);adModule.enableOverrideAds(true);adModule.setStayInFullScreen(true);var experienceModule=bcExperience.getModule(APIModules.EXPERIENCE);experienceModule.addEventListener(BCExperienceEvent.CONTENT_LOAD,function(){var socialModule=bcExperience.getModule(APIModules.SOCIAL);videoId=videoModule.getCurrentVideo().referenceId;var videoDateObj=videoModule.getCurrentVideo().publishedDate;videoDate=""+(videoDateObj.getMonth()+1)+"/"+videoDateObj.getDate()+"/"+videoDateObj.getFullYear();socialModule.setEmbedCode('<iframe width="480" height="373" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" id="nyt_video_player" title="New York Times Video - Embed Player" src="http://graphics8.nytimes.com/bcvideo/1.0/iframe/embed.html?videoId='+videoId+'&playerType=embed"></iframe>');var videoDateMonth=(videoDateObj.getMonth()+1)<10?"0"+(videoDateObj.getMonth()+1):videoDateObj.getMonth();var videoDateDay=(videoDateObj.getDate()+1)<10?"0"+(videoDateObj.getDate()+1):videoDateObj.getDate();socialModule.setLink("http://video.nytimes.com/video/"+videoDateObj.getFullYear()+"/"+videoDateMonth+"/"+videoDateDay+"/continuous/"+videoId+"/timescast.html");var cuepointModule=bcExperience.getModule(APIModules.CUE_POINTS);cuepointModule.addEventListener("cuePoint",function(e){if(e.cuePoint.name==="midroll1"){if(midrollAdObj){showAndTrackAd();}else{adModule.resumeAfterExternalAd();}}});});experienceModule.addEventListener(BCExperienceEvent.ENTER_FULLSCREEN,function(e){NYTD.TimesCastManager.Tracking.trackGoBig(videoId,videoDate);});experienceModule.addEventListener(BCExperienceEvent.EXIT_FULLSCREEN,function(e){NYTD.TimesCastManager.Tracking.trackGoSmall(videoId,videoDate);});};var showAndTrackAd=function(){if(midrollAdObj["ADX_CLIENTSIDE"]){var trackingContainer=document.getElementById("timescastTrack");if(trackingContainer){trackingContainer.innerHTML=midrollAdObj["ADX_CLIENTSIDE"];}}if(midrollAdObj["VideoPlayerAd"]){adModule.showAd(midrollAdObj["VideoPlayerAd"]);return;}};var parseAdResponse=function(adRespObj){if(adRespObj){midrollAdObj=adRespObj;}};return{initialize:function(id){init(brightcove.getExperience("timescastVideoPlayerObj"));},adHandler:function(obj){parseAdResponse(obj);}};})();NYTD.TimesCastManager.Tracking={trackPlay:function(id,dateStr){dcsMultiTrack("DCS.dcssip","www.nytimes.com","DCS.dcsuri","/video/TimesCast/Play.html","WT.ti","Video TimesCast Play","WT.cg_n","Video","WT.videoCategory","TimesCast","WT.videoEvent","play","WT.videoLoad","user","WT.videoName","TimesCast: "+dateStr,"WT.z_gpt","Multimedia","WT.z_gpst","Video","WT.z_gpsst","Video-Play","WT.z_vid",id,"WT.z_vpt","TimesCast","WT.z_dcsm","0");},trackStop:function(id,dateStr){dcsMultiTrack("DCS.dcssip","www.nytimes.com","DCS.dcsuri","/video/TimesCast/Finish.html","WT.ti","Video TimesCast FinishStop","WT.cg_n","Video","WT.videoCategory","TimesCast","WT.videoEvent","finish","WT.videoLoad","null","WT.videoName","TimesCast: "+dateStr,"WT.z_gpt","Multimedia","WT.z_gpst","Video","WT.z_gpsst","Video-Finish","WT.z_vid",id,"WT.z_vpt","TimesCast","WT.z_dcsm","0");},trackGoBig:function(id,dateStr){dcsMultiTrack("DCS.dcssip","www.nytimes.com","DCS.dcsuri","/video/TimesCast/GoBig.html","WT.ti","Video TimesCast GoBig","WT.cg_n","Video","WT.videoCategory","TimesCast","WT.videoEvent","Go Big","WT.videoLoad","null","WT.videoName","TimesCast: "+dateStr,"WT.z_gpt","Multimedia","WT.z_gpst","Video","WT.z_gpsst","Video-Go","WT.z_vid",id,"WT.z_vpt","TimesCast","WT.z_dcsm","1");},trackGoSmall:function(id,dateStr){dcsMultiTrack("DCS.dcssip","www.nytimes.com","DCS.dcsuri","/video/TimesCast/GoSmall.html","WT.ti","Video TimesCast GoSmall","WT.cg_n","Video","WT.videoCategory","TimesCast","WT.videoEvent","Go Small","WT.videoLoad","null","WT.videoName","TimesCast: "+dateStr,"WT.z_gpt","Multimedia","WT.z_gpst","Video","WT.z_gpsst","Video-Go","WT.z_vid",id,"WT.z_vpt","TimesCast","WT.z_dcsm","1");}};NYTD.TimesCastManager.NativePlayer=(function(){var videoId,videoDate;var init=function(){var apiCall="http://api.brightcove.com/services/library?command=find_video_by_reference_id&reference_id="+NYTD.TimesCastVideoId+"&token=cE97ArV7TzqBzkmeRVVhJ8O6GWME2iG_bRvjBTlNb4o.&callback=NYTD.TimesCastManager.NativePlayer.apiHandler";var apiScript=document.createElement("script");apiScript.setAttribute("src",apiCall);document.getElementsByTagName("head")[0].appendChild(apiScript);};var handleApiResponse=function(obj){if(!obj){return false;}var videoFile="";if(obj.renditions){var encodes=obj.renditions;for(var i=0;i<encodes.length;++i){var cur=encodes[i];if(cur.videoCodec=="H264"&&cur.referenceId.indexOf("video_well_s_nb")!=-1){videoFile=cur.url;break;}}}$$(".timescastVideoPlayer")[0].innerHTML='<video id="timesCastNative" src="'+videoFile+'" controls poster="'+obj.videoStillURL+'" style="height:190px;width:337px">';videoId=obj.referenceId;var videoDateObj=new Date(obj.publishedDate);videoDate=""+(videoDateObj.getMonth()+1)+"/"+videoDateObj.getDate()+"/"+videoDateObj.getFullYear();var videoPlayer=$("timesCastNative");videoPlayer.observe("play",function(){NYTD.HomepageRefresh.stop(refreshTimerId);dcsMultiTrack("DCS.dcssip","www.nytimes.com","DCS.dcsuri","/video/TimesCast HTML5/Play.html","WT.ti","Video TimesCast HTML5 Play","WT.cg_n","Video","WT.videoCategory","TimesCast","WT.videoEvent","play","WT.videoLoad","user","WT.videoName","TimesCast: "+dateStr,"WT.z_gpt","Multimedia","WT.z_gpst","Video","WT.z_gpsst","Video-Play","WT.z_vid",id,"WT.z_vpt","TimesCast HTML5","WT.z_dcsm","0");});videoPlayer.observe("ended",function(){NYTD.HomepageRefresh.start(refreshTimerId);dcsMultiTrack("DCS.dcssip","www.nytimes.com","DCS.dcsuri","/video/TimesCast HTML5/Finish.html","WT.ti","Video TimesCast HTML5 FinishStop","WT.cg_n","Video","WT.videoCategory","TimesCast","WT.videoEvent","finish","WT.videoLoad","null","WT.videoName","TimesCast: "+dateStr,"WT.z_gpt","Multimedia","WT.z_gpst","Video","WT.z_gpsst","Video-Finish","WT.z_vid",id,"WT.z_vpt","TimesCast HTML5","WT.z_dcsm","0");});};return{initialize:function(){init();},apiHandler:function(obj){handleApiResponse(obj);}};})();NYTD.TimesCastManager.turnkey=function(){if(navigator.userAgent.indexOf("AppleWebKit")>=0&&("createTouch" in document)){NYTD.TimesCastManager.NativePlayer.initialize();}else{var tcPlayerObj=$("timescastVideoPlayerObj");NYTD.BCVideoAsyncManager.registerCallback(function(){brightcove.createExperience(tcPlayerObj,tcPlayerObj,false);});}};NYTD.HPChannelPlayer=(function(){var playerObjectId="channelPlayer";var playlistId;var experienceModule=null;var playerModule=null;var contentModule=null;var adModule=null;var videoList=[];var selectedThumbEl=null;var moreVideoPromoShowing=false;var refreshTimerId=NYTD.HomepageRefresh.register("pocket channel player");var adxTrackingContainer=null;var adxTrackingContainerId=null;var init=function(bcObj){experienceModule=bcObj.getModule(APIModules.EXPERIENCE);playerModule=bcObj.getModule(APIModules.VIDEO_PLAYER);contentModule=bcObj.getModule(APIModules.CONTENT);adModule=bcObj.getModule(APIModules.ADVERTISING);experienceModule.addEventListener(BCExperienceEvent.TEMPLATE_READY,templateReadyHandler);playerModule.addEventListener(BCVideoEvent.STREAM_START,streamStartHandler);playerModule.addEventListener(BCVideoEvent.VIDEO_START,mediaStartHandler);playerModule.addEventListener(BCVideoEvent.VIDEO_COMPLETE,videoCompleteHandler);experienceModule.addEventListener(BCExperienceEvent.CONTENT_LOAD,contentLoadedHandler);experienceModule.addEventListener("enterFullScreen",function(){trackVideo("go","GoBig","null",1);});experienceModule.addEventListener("exitFullScreen",function(){trackVideo("go","GoSmall","null",1);});setADXTrackingContainer();};var setADXTrackingContainer=function(){adxTrackingContainerId="adxTrackingContainer_"+new Date().getTime();if(!adxTrackingContainer){adxTrackingContainer=document.createElement("div");adxTrackingContainer.setAttribute("id",adxTrackingContainerId);adxTrackingContainer.setAttribute("visibility","hidden");document.getElementsByTagName("body")[0].appendChild(adxTrackingContainer);}};var templateReadyHandler=function(e){var getSection=function(tagArr){for(var i=0;i<tagArr.length;i++){if(tagArr[i].indexOf("nyto_")>=0){return tagArr[i].substring(5);}}return"";};var playlistObj=contentModule.getPlaylist(playlistId,"referenceId");var limit=(playlistObj.videoIds.length>4)?4:playlistObj.videoIds.length;for(var i=0;i<limit;i++){var curVideo=contentModule.getVideo(playlistObj.videoIds[i]);curVideo.section=getSection(curVideo.tags);videoList.push(curVideo);}renderTemplate();};var renderTemplate=function(){for(var i=0,len=videoList.length;i<len;++i){var videoData=videoList[i],thumbEl=$("thumbContainer-"+i);thumbEl.index=i;thumbEl.update(""+'<img src="'+videoData.thumbnailURL+'" width="75" height="50" alt="'+videoData.displayName.escapeHTML()+'" />'+'<div class="videoThumbOverlay"></div>'+'<div class="videoThumbPlayOverlay kicker">PLAY</div>'+'<div class="kicker section">'+videoData.section+"</div>"+'<div class="videoThumbPointerIcon"></div>');if(i===0){selectedThumbEl=thumbEl;selectThumb(thumbEl);selectedThumbEl.addClassName("playing");NYTD.Video.Share.initializeShareSFHP(videoData,$("channelPlayer"));}}addTabEventHandlers();};var selectThumb=function(thumbEl){var currentIndex=thumbEl.index,videoData=videoList[currentIndex];selectedThumbEl.removeClassName("selected");selectedThumbEl=thumbEl;selectedThumbEl.addClassName("selected");setMetaData(currentIndex);};var setMetaData=function(index){var videoData=videoList[index];$("sectionName").update(videoData.section);$("videoTitle").update(videoData.displayName);$("videoShortDesc").update(videoData.shortDescription);};var addTabEventHandlers=function(){for(var i=0;i<4;++i){var thumbEl=$("thumbContainer-"+i);thumbEl.observe("mouseover",(function(index){return function(e){mouseOverTabHandler(index);};})(i));thumbEl.observe("mouseout",(function(index){return function(e){mouseOutTabHandler(index);};})(i));thumbEl.observe("click",(function(index){return function(e){clickTabHandler(index);};})(i));}};var mouseOverTabHandler=function(index){if(index!=selectedThumbEl.index){var hoverThumb=$("thumbContainer-"+index);hoverThumb.addClassName("selected");$("infoSection").update(videoList[index].section);$("infoTitle").update(videoList[index].displayName);$("infoDesc").update(videoList[index].longDescription);$("infoOverlay").style.display="block";}};var mouseOutTabHandler=function(index){if(index!=selectedThumbEl.index){var hoverThumb=$("thumbContainer-"+index);hoverThumb.removeClassName("selected");$("infoOverlay").style.display="none";}};var clickTabHandler=function(index){playVideo(index,"user");$("infoOverlay").style.display="none";};var playVideo=function(index,caller){selectedThumbEl.removeClassName("playing");var thumbEl=$("thumbContainer-"+index);selectThumb(thumbEl);selectedThumbEl.addClassName("playing");$("titleInfoContainer").addClassName("playing");playerModule.loadVideo(videoList[index].id);if(moreVideoPromoShowing){$("screenCover").addClassName("hidden");}NYTD.Video.Share.setCurrentVideo(videoList[index]);};var streamStartHandler=function(e){trackVideo("play","PlayStart","null",0);};var mediaStartHandler=function(e){NYTD.HomepageRefresh.stop(refreshTimerId);if(moreVideoPromoShowing){$("screenCover").addClassName("hidden");moreVideoPromoShowing=false;}$("titleInfoContainer").addClassName("playing");};var videoCompleteHandler=function(e){trackVideo("finish","FinishStop","null",0);NYTD.HomepageRefresh.start(refreshTimerId);if((1+selectedThumbEl.index)<videoList.length){playVideo((1+selectedThumbEl.index),"autoplay");}else{$("screenCover").removeClassName("hidden");moreVideoPromoShowing=true;$("titleInfoContainer").removeClassName("playing");}};var contentLoadedHandler=function(e){if(!adModule.getExternalAdsEnabled()){adModule.enableExternalAds(true);adModule.addEventListener("externalAd",externalAdEvent);}};var externalAdEvent=function(e){var adUrl="http://video.nytimes.com/svc/ads/video/SinglePlayerVideoAd.js?callback=NYTD.HPChannelPlayer.adResponseHandler&positions=VideoPlayerAd,ADX_CLIENTSIDE,Inv1,Inv2,Inv3&pagename=www.nytimes.com/homepage/video&ver="+Math.random();var scriptElem=new Element("script");scriptElem.type="text/javascript";scriptElem.src=adUrl;document.getElementsByTagName("head")[0].appendChild(scriptElem);};var adRespHandler=function(adObj){var jsonResp=adObj||{};if(jsonResp["ADX_CLIENTSIDE"]){jsonResp["ADX_CLIENTSIDE"]=jsonResp["ADX_CLIENTSIDE"]+"";var adxTrackerRegex=/^\s*(<img.+src=['"])(.+)$/gi;var matches=adxTrackerRegex.exec(jsonResp["ADX_CLIENTSIDE"]);if(matches&&matches.length==3){jsonResp["ADX_CLIENTSIDE"]=matches[1]+"http://www.nytimes.com"+matches[2];}}var didPlayVideoAd=false;for(positionName in jsonResp){if(positionName=="VideoPlayerAd"){if(jsonResp.VideoPlayerAd){adModule.showAd(jsonResp.VideoPlayerAd);didPlayVideoAd=true;}else{didPlayVideoAd=false;}}else{if(adxTrackingContainer){if(jsonResp[positionName]){adxTrackingContainer.innerHTML=jsonResp[positionName];}}}}if(!didPlayVideoAd){adModule.resumeAfterExternalAd();}};var trackVideo=function(eventName,subType,actor,dcsm){var curVideo=videoList[selectedThumbEl.index];try{dcsMultiTrack("WT.videoName",curVideo.displayName,"WT.videoCategory",curVideo.section,"WT.videoLoad",actor,"WT.videoEvent",eventName,"WT.z_vid",curVideo.referenceId,"WT.z_vpt","Homepage","WT.z_gpt","Multimedia","WT.z_gpst","Video","WT.z_gpsst","Video-Play","WT.ti","Video Homepage "+subType,"WT.z_dcsm",dcsm);}catch(e){}};return{setup:function(options){playlistId=options.playlistId;var callbackFunc=function(){var player=$(playerObjectId);var newParam=new Element("param");newParam.name="@playlistTabs";newParam.value="ref:"+playlistId;player.appendChild(newParam);brightcove.createExperience(player,player,false);NYTD.Video.Share.initTimesPeople();};if(navigator.userAgent.indexOf("AppleWebKit")>=0&&("createTouch" in document)){var iframeTag='<iframe src="http://graphics8.nytimes.com/bcvideo/1.0/iframe/nativeVideo.html?playlistId='+playlistId+'" id="nyt_video_player" width="337" height="393" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>';$("multiPlayer").innerHTML=iframeTag;}else{NYTD.BCVideoAsyncManager.registerCallback(callbackFunc);}},initialize:function(){init(brightcove.getExperience(playerObjectId));},adResponseHandler:adRespHandler};})();NYTD.ArticleShareToolsPostToNetwork=function(network,meta){function postPopUp(url,name,params){var win=window.open(url,name,params);}var openers={newsvine:function(){var keywords=meta.getSection();if(typeof(getShareSubSection)=="function"){if(meta.getSubSection()!=""){keywords+=","+meta.getSubSection();}}if(meta.getKeywords()!=""){keywords+=","+meta.getKeywords();}postPopUp("http://www.newsvine.com/_wine/save?ver=2&popoff=0&aff=nytimes&t="+keywords+"&e="+meta.getDescription()+"&h="+meta.getHeadline()+"&u="+meta.getURL("newsvine"),"newsvine","toolbar=0,status=0,height=445,width=650,scrollbars=yes,resizable=yes");s_code_linktrack("Article-Tool-Share-Newsvine");},facebook:function(){postPopUp("http://www.facebook.com/sharer.php?u="+meta.getURL()+"&t="+meta.getHeadline(),"facebook","toolbar=0,status=0,height=436,width=646,scrollbars=yes,resizable=yes");s_code_linktrack("Article-Tool-Share-Facebook");},digg:function(){postPopUp("http://digg.com/remote-submit?phase=2&url="+meta.getURL()+"&title="+meta.getHeadline()+"&bodytext="+meta.getDescription(),"digg","toolbar=0,status=0,height=450,width=650,scrollbars=yes,resizable=yes");s_code_linktrack("Article-Tool-Share-Digg");},permalink:function(){postPopUp("http://"+window.location.hostname+"/export_html/common/new_article_post.html?url="+meta.getURL()+"&title="+meta.getHeadline()+"&summary="+meta.getDescription()+"&section="+meta.getSectionDisplay()+"&pubdate="+meta.getPubdate()+"&byline="+meta.getByline(),"permalink","toolbar=0,status=0,height=410,width=490,scrollbars=yes,resizable=no");s_code_linktrack("Article-Tool-Share-Permalink");},delicious:function(){postPopUp("http://del.icio.us/post?v=4&partner=nyt&noui&jump=close&url="+meta.getURL()+"&title="+meta.getHeadline()+"&bodytext="+meta.getDescription(),"delicious","toolbar=0,status=0,height=400,width=700,scrollbars=yes,resizable=no");s_code_linktrack("Article-Tool-Share-Delicious");},linkedin:function(){postPopUp("http://www.linkedin.com/shareArticle?mini=true"+"&url="+meta.getURL()+"&title="+meta.getHeadline()+"&summary="+meta.getDescription()+"&source="+"The New York Times","Linkedin","toolbar=0,status=0,height=550,width=700,scrollbars=yes,resizable=no");s_code_linktrack("Article-Tool-Share-LinkedIn");},myspace:function(){postPopUp("http://www.myspace.com/index.cfm?fuseaction=postto&u="+meta.getURL()+"&t="+meta.getHeadline()+"&c="+meta.getDescription(),"myspace","toolbar=0,status=0,height=436,width=880,scrollbars=yes,resizable=yes");s_code_linktrack("Article-Tool-Share-MySpace");},twitter:function(){postPopUp("http://twitter.com/index.cfm?fuseaction=postto&u="+meta.getURL()+"&t="+meta.getHeadline()+"&c="+meta.getDescription(),"myspace","toolbar=0,status=0,height=436,width=880,scrollbars=yes,resizable=yes");s_code_linktrack("Article-Tool-Share-MySpace");}};openers[network]();};NYTD.ArticleShareTools=function(rootId,meta){var NYTShareAdScript="http://www.nytimes.com/adx/bin/adx_remote.html?type=fastscript&page=www.nytimes.com/yr/mo/day/&posall=Frame6A&query=qstring&keywords=?",imageHost="http://graphics8.nytimes.com",imagePath="/images/article/functions/",parentElement,postElement,postLink,closeLink,postList,closeTimerId;var meta=meta||{getDescription:function(){return getShareDescription();},getURL:function(){return getShareURL();},getHeadline:function(){return getShareHeadline();},getKeywords:function(){return getShareKeywords();},getSection:function(){return getShareSection();},getSectionDisplay:function(){return getShareSectionDisplay();},getByline:function(){return getShareByline();},getSubSection:function(){return getShareSubSection();},getPubdate:function(){return getSharePubdate();}};if(closeLink!==undefined){$(document).observe("click",function(event){if(closeLink.hasClassName("closeButton")&&outsideShareTools(event.target)){closeShareTools();}});}this.writePost=function(excludedShareTypes){parentElement=getShareRootElement();postElement=this.makePostElement(parentElement);postElement.style.width="168px";postLink=makePostLink();closeLink=makeCloseLink();postList=makePostList();postElement.appendChild(postLink);postElement.appendChild(closeLink);if(excludedShareTypes){window.shareToolsExcludeList=excludedShareTypes;}addShareTargets(postList);postElement.appendChild(postList);parentElement.appendChild(postElement);addFacebook();};this.writeLinks=function(sList,excludedShareTypes){if(excludedShareTypes){window.shareToolsExcludeList=excludedShareTypes;}addShareLinks(sList);};this.makePostElement=function(root){if(root===undefined){getShareRootElement();}if(root.id=="toolsList"){return new Element("LI",{id:"shareMenu"}).addClassName("closed");}else{if(root.id=="shareToolButton"){return new Element("SPAN",{id:"shareMenu"}).addClassName("closed");}else{throw ("Couldn't find share tool element.");}}};function getShareRootElement(){var root;if(rootId){return $(rootId);}if(root=$("toolsList")){return root;}else{if(root=$("shareToolButton")){root.update("");return root;}}}function makePostLink(){var postLink=new Element("a",{href:"#"}).update("Share").addClassName("shareButton");postLink.observe("click",function(event){displayShareTools(postElement);event.stop();return false;});return postLink;}function makeCloseLink(){closeLink=new Element("a",{"href":"#"}).update("Close").addClassName("hidden");closeLink.style.opacity=0;closeLink.observe("click",function(event){closeShareTools();event.stop();return false;});return closeLink;}function makePostList(){var postList=new Element("ul",{"id":"shareList"}).addClassName("hidden");postList.style.opacity=0;return postList;}function displayShareTools(element){if(element.hasClassName("closed")){if(parentElement.id=="shareToolButton"||parentElement.hasClassName("toolsList")){parentElement.addClassName("shareMenuOpened");}element.className="opened";new Effect.Scale(element,200,{duration:0.5,scaleContent:false,scaleMode:{originalWidth:167.5,originalHeight:114},afterFinish:function(){closeLink.className="closeButton";$("shareList").className="";toggleShareAd("show");new Effect.Opacity(closeLink,{duration:0.5,from:0,to:1});new Effect.Opacity($("shareList"),{duration:0.5,from:0,to:1});var numEvent=0;$(document).observe("mouseover",function(event){if(closeLink.hasClassName("closeButton")&&outsideShareTools(event.target)&&numEvent==0){closeTimerId=window.setTimeout(closeShareTools,5000);numEvent++;}event.stop();return false;});}});}else{closeShareTools();}}function closeShareTools(){clearTimeout(closeTimerId);closeLink.className="hidden";new Effect.Opacity($("shareList"),{duration:0.5,from:1,to:0,afterFinish:function(){$("shareList").className="hidden";toggleShareAd("hide");new Effect.Scale($("shareMenu"),50,{duration:0.5,scaleMode:{originalWidth:335,originalHeight:228},scaleContent:false,afterFinish:function(){$("shareMenu").className="closed";if(parentElement.hasClassName("shareMenuOpened")){parentElement.removeClassName("shareMenuOpened");}}});}});new Effect.Opacity(closeLink,{from:1,to:0});}function outsideShareTools(target){var bool=!(target.id=="shareMenu"||target.id=="shareList");for(var i=0;i<$("shareMenu").childNodes.length;i++){if(target==$("shareMenu").childNodes[i]){bool=false;}}for(var i=0;i<$("shareList").childNodes.length;i++){var node=$("shareList").childNodes[i];if(target==node||target==node.childNodes[0]){bool=false;}}for(var i=0;i<$("shareMenuAd").childNodes.length;i++){var node=$("shareMenuAd").childNodes[i];if(target==node||target==node.childNodes[0]){bool=false;}}return bool;}function toggleShareAd(state){if(typeof adxpos_Frame6A!="undefined"){state=="show"?displayShareAd():hideShareAd();}else{$("shareMenu").className="opened noAd";}}function displayShareAd(){$("shareMenuAd").update("<span class='shareSponsor'></span>"+adxads[adxpos_Frame6A]);}function hideShareAd(){$("shareMenuAd").update("");var reloadScript=new Element("script",{src:NYTShareAdScript});$("shareMenuAd").appendChild(reloadScript);}function postPopUp(url,name,params){var win=window.open(url,name,params);}function itemInExcludeList(sharelinkName){return typeof window.shareToolsExcludeList!="undefined"&&typeof window.shareToolsExcludeList[sharelinkName]!="undefined";}function addShareLink(parentElement,sharelinkName,sharelinkText){if(itemInExcludeList(sharelinkName)){return;}var postItem=new Element("li").addClassName(sharelinkName);var itemLink=new Element("a",{href:"#"}).update(sharelinkText);itemLink.style.backgroundImage="url("+imageHost+imagePath+sharelinkName+".gif)";itemLink.observe("click",function(e){NYTD.ArticleShareToolsPostToNetwork(sharelinkName,meta);e.stop();});postItem.appendChild(itemLink);parentElement.appendChild(postItem);}function addShareLinks(sList){var typeMeta=$$('meta[name="PT"]')[0];addShareLink(sList,"linkedin","Linkedin");addShareLink(sList,"digg","Digg");if(!typeMeta||typeMeta.content!="Article"){addShareLink(sList,"facebook","Facebook");}addShareLink(sList,"myspace","MySpace");addShareLink(sList,"permalink","Permalink");}function addShareTargets(shareList){var sList=$(shareList);addShareLinks(sList);var shareMenuAd=new Element("li",{id:"shareMenuAd"});var loadScript=new Element("SCRIPT",{"src":NYTShareAdScript});shareMenuAd.appendChild(loadScript);sList.appendChild(shareMenuAd);}function addFacebook(){var target=$("toolsList");if(target){var postItem=new Element("li").addClassName("facebook");var itemLink=new Element("a",{href:"#"}).update("Facebook");itemLink.style.backgroundImage="url("+NYTD.Hosts.imageHost+"/images/article/functions/facebook.gif)";itemLink.style.backgroundRepeat="no-repeat";itemLink.style.backgroundPosition="-1px -1px";itemLink.style.padding="0 0 3px 20px";itemLink.observe("click",function(e){window.open("http://www.facebook.com/sharer.php?u="+meta.getURL()+"&t="+meta.getHeadline(),"facebook","toolbar=0,status=0,height=436,width=646,scrollbars=yes,resizable=yes");s_code_linktrack("Article-Tool-Share-Facebook");e.stop();});postItem.appendChild(itemLink);target.insert({top:postItem});}}};NYTD.ArticleShareAd=function(position,form_data){var el=$(position);var etaForm=$(document.forms.emailThis);if(!el||!etaForm){return;}function popupPermalink(e){e.stop();NYTD.ArticleShareToolsPostToNetwork("permalink",meta);}function overloadETAForm(e){e.stop();etaForm.getElements().each(function(input){if(typeof form_data[input.name]!="undefined"){input.setValue(form_data[input.name]);}});etaForm.submit();}var meta={getDescription:function(){return form_data.description;},getURL:function(){return form_data.url;},getHeadline:function(){return form_data.title;},getKeywords:function(){return"";},getSection:function(){return"Advertisement";},getSectionDisplay:function(){return"Advertisement";},getByline:function(){return"";},getSubSection:function(){return"";},getPubdate:function(){return"";}};var wrapper=new Element("ul").addClassName("articleAdTools clearfix");var permalink=new Element("li").update('<a href="#">Link To This Ad</a>').addClassName("perma");var emaillink=new Element("li").update('<a href="#">E-Mail This Ad &#187;</a>').addClassName("email");$(permalink.getElementsByTagName("a")[0]).observe("click",popupPermalink.bindAsEventListener());$(emaillink.getElementsByTagName("a")[0]).observe("click",overloadETAForm.bindAsEventListener());wrapper.insert(permalink);wrapper.insert(emaillink);el.insert({bottom:wrapper});};NYTD.ArticleShareAdExpiredAlert=function(){var body=$(document.getElementsByTagName("body")[0]);var bodySize=body.getDimensions();var background=new Element("div").setStyle({"backgroundColor":"#000000","width":bodySize.width+"px","height":bodySize.height+"px","position":"absolute","top":0,"left":0,"zIndex":900000}).setOpacity("0.7");var top=Math.floor((document.documentElement.clientHeight-90)/2);var left=Math.floor((document.documentElement.clientWidth-400)/2);var a_alert=new Element("div").update('<p>Sorry, the advertising campaign you are looking for has ended.</p><a href="#" class="close">Close</a>').setStyle({"top":top+"px","left":left+"px"}).addClassName("expiredAd");function removeAlert(e){e.stop();background.remove();a_alert.remove();}Event.observe(window,"load",function(){window.scrollTo(0,0);body.appendChild(background);body.appendChild(a_alert);$(a_alert.getElementsByTagName("a")[0]).observe("click",removeAlert.bindAsEventListener());});};function getShareURL(){if(NYTD.Video.Share.currentVideo.customFields){return NYTD.Video.Share.currentVideo.customFields.videourl;}}function getShareHeadline(){return NYTD.Video.Share.currentVideo.name||NYTD.Video.Share.currentVideo.displayName;}NYTD.Video={playerType:"homepage"};NYTD.Video.Share=function(){var initialized=false;var playerEl;function getEmbedCode(videoId){var embedIframeURL="http://graphics8.nytimes.com/bcvideo/1.0/iframe/embed.html";if(!videoId||!NYTD.Video.hasRights){return"This video cannot be embedded";}else{return'<iframe width="480" height="373" frameborder="0" scrolling="no" marginheight="0" '+'marginwidth="0" id="nyt_video_player" title="New York Times Video - Embed Player" src="'+embedIframeURL+"?videoId="+videoId+'&playerType=embed"></iframe>';}}function initShareNetworks(pObj){var shareListEl=$("shareList");var shareTools=new NYTD.ArticleShareTools(shareListEl,{getDescription:function(){return pObj.longDescription;},getURL:function(){return pObj.customFields.videourl;},getHeadline:function(){return pObj.name||pObj.displayName;},getKeywords:function(){return pObj.publishedDate;},getSection:function(){return pObj.section;},getSectionDisplay:function(){return pObj.section;},getByline:function(){return pObj.shortDescription;},getSubSection:function(){return pObj.section;},getPubdate:function(){return new Date(parseInt(pObj.publishedDate,10));}});shareListEl.update("");shareTools.writeLinks(shareListEl,{"permalink":"hide"});if(NYTD.Video.playerType=="embed"){NYTD.TwitterTool.initialize(shareListEl,pObj.name,pObj.customFields.videourl);}}function initialize(pObj,player){var shareContEl=$("bc_share"),shareStoryEl=shareContEl.select(".story")[0],inputEls=$$("#toolsList .embeds input"),embedCodeEl=$("embed_code"),triggerEl=$("shareButton"),embedCode=getEmbedCode(pObj.referenceId);NYTD.Video.Share.isShareOpen=false;playerEl=player;if(shareStoryEl){var origStoryEl=$$("#bc_articleInfo .story")[0];if(!pObj.thumbnailURL){var thumbnailURL="/images/video/t-thumbnail-75x50.jpg";}else{var thumbnailURL=pObj.thumbnailURL;}if(!initialized){var thumbEl=new Element("img",{"id":"thumbImage","class":"thumb","src":thumbnailURL});shareStoryEl.appendChild(thumbEl);}else{$("thumbImage").setAttribute("src",thumbnailURL);}if(!initialized){shareStoryEl.appendChild(new Element("span",{"id":"videoName"}).update(pObj.name||pObj.displayName));if(NYTD.Video.playerType=="embed"){shareStoryEl.appendChild(origStoryEl.select(".summary")[0].cloneNode(true));}thumbEl.width=75;thumbEl.height=50;}else{$("videoName").update(pObj.name||pObj.displayName);}}var videoUrl=pObj.customFields&&pObj.customFields.videourl;$("video_permalink").writeAttribute("value",videoUrl);embedCodeEl.removeAttribute("disabled");embedCodeEl.writeAttribute("value",embedCode);if(!NYTD.Video.hasRights){embedCodeEl.setAttribute("disabled","disabled");}initShareNetworks(pObj);if(initialized){return;}triggerEl.observe("click",function(event){shareContEl.removeClassName("hidden");playerEl.setStyle({"left":"-1000px"});NYTD.Video.Share.isShareOpen=true;if(NYTD.Video.Share.currentVideo){initialize(NYTD.Video.Share.currentVideo,playerEl);}Event.stop(event);});$("closeButton").observe("click",function(event){playerEl.setStyle({"left":"0"});shareContEl.addClassName("hidden");NYTD.Video.Share.isShareOpen=false;if($("twitter_panel")){TimesPeople.TwitterTool.close();}setShareButton();Event.stop(event);});inputEls.each(function(el){var select=function(){el.select();};el.observe("focus",select);el.observe("click",select);});initialized=true;}function initializeShareSFHP(video,playerElement){playerEl=$(playerElement);var titleContainer=$("titleInfoContainer");titleContainer.appendChild(new Element("a",{"href":"#","class":"shareButton","id":"shareButton"}).update("Share"));NYTD.Video.Share.initialize(video,playerEl);setCurrentVideo(video);}function setCurrentVideo(video){NYTD.Video.Share.currentVideo=video;NYTD.Video.hasRights=(video.tags.indexOf("nyt_rights")!==-1);if(!NYTD.Video.Share.isShareOpen){setShareButton();}}function setShareButton(){videoUrl=NYTD.Video.Share.currentVideo.customFields&&NYTD.Video.Share.currentVideo.customFields.videourl;if(videoUrl){$("shareButton").show();}else{$("shareButton").hide();}}function initTimesPeople(){var position_right,position_top;var tpAssetObj={getSection:function(){return NYTD.Video.Share.currentVideo.section.toLowerCase();},getTitle:function(){return NYTD.Video.Share.currentVideo.name||NYTD.Video.Share.currentVideo.displayName;},getDescription:function(){return NYTD.Video.Share.currentVideo.shortDescription;},getUrl:function(){return NYTD.Video.Share.currentVideo.customFields.videourl;},getThumbnail:function(){return NYTD.Video.Share.currentVideo.thumbnailURL;},getType:function(){return"video";}};(function(){var user=new TimesPeople.User();user.register({update:function(){var tools=$("timespeople_tools");new TimesPeople.RecommendTool(tools,"bottom",tpAssetObj).draw();switch(NYTD.Video.playerType){case"section":position_right=-57;position_top=-68;break;case"homepage":position_right=-92;position_top=-81;break;case"blog":position_right=-67;position_top=-81;break;case"article":default:position_right=-67;position_top=-81;}TimesPeople.TwitterTool.initialize(tools,"bottom",position_right,position_top,tpAssetObj);user.unregister(this);}});})();}return{initialize:initialize,initializeShareSFHP:initializeShareSFHP,setCurrentVideo:setCurrentVideo,initTimesPeople:initTimesPeople};}();NYTD.track=function(){if("dcsMultiTrack" in window){dcsMultiTrack.apply(this,arguments);}else{setTimeout(function(){NYTD.track.apply(this,arguments);},1000);}};NYTD.Facebook={APP_ID:"9869919170",API_KEY:"990e3f5d72ed31535d09dc1a05fb5ddd",CHANNEL:"http://www.nytimes.com/packages/html/facebook/fbchannel.html"};NYTD.Facebook.SDK=(function(){return{load:function(){if(!document.body){setTimeout(arguments.callee,100);}else{var d=document.createElement("div");d.id="fb-root";document.body.insertBefore(d,document.body.firstChild);var e=document.createElement("script");e.src=document.location.protocol+"//connect.facebook.net/en_US/all.js";e.async=true;document.body.insertBefore(e,document.body.firstChild);}},initialize:function(){FB.init({apiKey:NYTD.Facebook.API_KEY,appId:NYTD.Facebook.APP_ID,status:false,cookie:true,xfbml:false,channelUrl:NYTD.Facebook.CHANNEL});}};})();(function(app){app.Cookie={get:function(name){return new RegExp(name+"=([^;]+)").test(unescape(document.cookie))?RegExp.$1:null;},set:function(name,value,options){var newcookie=[escape(name)+"="+escape(value)];if(options){if(options.expires){newcookie.push("expires="+options.expires.toGMTString());}if(options.path){newcookie.push("path="+options.path);}if(options.domain){newcookie.push("domain="+options.domain);}if(options.secure){newcookie.push("secure");}}document.cookie=newcookie.join("; ");}};})(NYTD.Facebook);NYTD.Facebook=NYTD.Facebook||{};NYTD.Facebook.User=(function(){var callbacks=[],head=document.getElementsByTagName("head")[0],meta=new Element("meta",{"name":"WT.z_fbc"}),baseUrl="/svc/timespeople/toolbar/2.0/user/",fbloggedInUrl=baseUrl+"fbloggedin",setEmailFormatUrl=baseUrl+"setemailformat",unlinkUrl=baseUrl+"unlink",loginOrigin="";head.appendChild(meta);function notify(value,response){for(var i=0,callback;callback=callbacks[i];i++){callback(value,response);}}function setTrackingMeta(value){meta.content=value;}function processToken(response){var response=JSON.parse(response.responseText);if(response.error_id){switch(response.error_id){case 401:var date=new Date();date.setTime(date.getTime()+31536000000);NYTD.Facebook.Cookie.set("nyt-nofb","0",{domain:".nytimes.com",path:"/",expires:date});notify(false);break;case 402:var date=new Date();date.setTime(date.getTime()+31536000000);NYTD.Facebook.Cookie.set("nyt-nofb","1",{domain:".nytimes.com",path:"/",expires:date});notify(false);break;case 500:notify(false);break;}setTrackingMeta("0");}else{if(response.user.facebook_id){NYTD.Facebook.User.facebook_id=response.user.facebook_id;FB.init({apiKey:NYTD.Facebook.API_KEY,appId:NYTD.Facebook.APP_ID,status:false,cookie:true,xfbml:false,channelUrl:NYTD.Facebook.CHANNEL,session:{uid:response.user.facebook_id,access_token:response.user.fb_session_key}});notify(true);setTrackingMeta("1");}}}function onCodeSaved(response){NYTD.Facebook.User.unlinked=false;var date=new Date();date.setTime(date.getTime()-31536000000);NYTD.Facebook.Cookie.set("nyt-nofb","0",{domain:".nytimes.com",path:"/",expires:date});var response=JSON.parse(response.responseText);if(response.user&&response.user["new"]&&NYTD.Facebook.User.showNewsletterPrefs){NYTD.track("WT.z_fb_login","3","DCS.dcsuri","/facebook_regi"+loginOrigin+".html","WT.ti","Facebook Widget Regi","WT.z_fb","1","WT.z_dcsm","1");NYTD.Facebook.PrefsDialog.open();}loginOrigin="";}return{showNewsletterPrefs:true,isLoggedIn:function(callback){var session=FB.getSession();var noFB=NYTD.Facebook.Cookie.get("nyt-nofb");if(session){NYTD.Facebook.User.facebook_id=session.uid;notify(true);setTrackingMeta("1");}else{if(noFB){notify(false);}else{new Ajax.Request(fbloggedInUrl,{method:"get",onSuccess:processToken});}}},login:function(callback,origin){origin=origin?"_"+origin:"";var session=FB.getSession();if(session){NYTD.Facebook.User.saveCode(session.access_token,function(){if(callback&&typeof callback==="function"){callback();}notify(true);setTrackingMeta("1");NYTD.track("WT.z_fb_login","1","DCS.dcsuri","/facebook_post_logon"+origin+".html","WT.ti","Facebook Widget Post Logon","WT.z_fb","1","WT.z_dcsm","1");});}else{FB.login(function(response){if(response.session){loginOrigin=origin;NYTD.Facebook.User.saveCode(response.session.access_token,function(){if(callback&&typeof callback==="function"){callback();}notify(true);setTrackingMeta("1");NYTD.track("WT.z_fb_login","1","DCS.dcsuri","/facebook_post_logon"+origin+".html","WT.ti","Facebook Widget Post Logon","WT.z_fb","1","WT.z_dcsm","1");});}else{notify(false);NYTD.track("WT.z_fb_login","2","DCS.dcsuri","/facebook_post_logon"+origin+".html","WT.ti","Facebook Widget Post Logon","WT.z_fb","1","WT.z_dcsm","1");}},{perms:"offline_access,email,user_about_me,user_birthday,user_education_history,user_groups,user_hometown,user_interests,user_likes,user_location,user_website,user_work_history"});}},register:function(callback){if(callback&&typeof callback==="function"){callbacks.push(callback);}},saveCode:function(code,callback){new Ajax.Request(fbloggedInUrl+"?code="+code,{method:"get",onSuccess:function(response){onCodeSaved(response);callback();}});},setEmailFormat:function(queryString){new Ajax.Request(setEmailFormatUrl+"?"+queryString,{method:"get"});},isSelf:function(facebook_id){return NYTD.Facebook.User.facebook_id&&NYTD.Facebook.User.facebook_id==facebook_id;},unlink:function(){if(!NYTD.Facebook.User.unlinked){FB.logout();NYTD.Facebook.User.unlinked=true;new Ajax.Request(unlinkUrl,{method:"get",onSuccess:function(){notify(false);}});}}};})();NYTD.Facebook=NYTD.Facebook||{};NYTD.Facebook.Feeds=(function(){var defaultLimit=3;var knownURLs=[];function handleError(response){switch(response.error_code){case"190":default:NYTD.Facebook.User.unlink();}}function request(method,callback,limit){FB.api({method:method,site:"nytimes.com",limit:limit||defaultLimit},function(response){if(response.error_code){handleError(response);return;}callback(response);});}function filterSelf(items){var filteredItems=[];for(var i=0,item;item=items[i];i++){if(NYTD.Facebook.User.isSelf(item.user.id)){continue;}filteredItems.push(item);}return filteredItems;}return{getRecommendations:function(callback,limit){if(FB.getSession()&&!NYTD.Facebook.User.unlinked){request("recommendations.get",callback,limit);}else{this.getDefaultRecommendations(callback);}},getDefaultRecommendations:function(callback,limit){new Ajax.Request("/facebook?format=json",{method:"get",onSuccess:function(response){callback(JSON.parse(response.responseText).slice(0,(limit||defaultLimit)));}});},getActivity:function(callback,limit){limit=limit||defaultLimit;var paddedlimit=limit+3;request("activity.get",function(items){items=filterSelf(items);items=items.slice(0,limit);callback(items);},paddedlimit);},dedupe:function(items){var filteredItems=[];for(var i=0,item;item=items[i];i++){if(item.url in knownURLs){continue;}item.title=item.title.replace(" - NYTimes.com","");filteredItems.push(item);knownURLs[item.url]=1;}return filteredItems;}};})();if(typeof Object.create!=="function"){Object.create=function(o){function F(){}F.prototype=o;return new F();};}NYTD.Facebook=NYTD.Facebook||{};NYTD.Facebook.BaseController={run:function(){NYTD.Facebook.SDK.initialize();this.patch();},render:function(isLoggedIn){if(isLoggedIn){this.view.renderLoggedIn();this.getLoggedInFeeds();}else{this.view.renderLoggedOut();NYTD.Facebook.Feeds.getRecommendations(function(feed){this.view.updatePopular(feed);}.bind(this),2);}},patch:function(){var cColumn=$$(".cColumn").first();if(cColumn){var holder=new Element("div",{"id":"facebookContainer"}).addClassName("columnGroup");if($(document.body).hasClassName("wideAd")){cColumn.insert({bottom:holder});}else{if(!$("FixedPanel")){cColumn.insert({top:holder});}}NYTD.Facebook.User.register(this.render.bind(this));NYTD.Facebook.User.isLoggedIn();}else{setTimeout(this.patch.bind(this),10);}},mergeFeeds:function(){if("activities" in this&&"recommendations" in this){try{if(this.activities.length){var activities=NYTD.Facebook.Feeds.dedupe(this.activities);var recommendations=NYTD.Facebook.Feeds.dedupe(this.recommendations);this.view.updateNetwork(activities);this.view.updateRecommendations(recommendations.splice(0,(4-activities.length)));}else{this.view.setHeader("Popular on Facebook");this.view.updatePopular(this.recommendations);}}catch(e){var self=this;NYTD.Facebook.Feeds.getDefaultRecommendations(function(){self.view.setHeader("Popular on Facebook");self.view.updatePopular(self.recommendations);});}}},getLoggedInFeeds:function(){NYTD.Facebook.Feeds.getActivity(function(feed){this.activities=feed;this.mergeFeeds();}.bind(this));NYTD.Facebook.Feeds.getRecommendations(function(feed){this.recommendations=feed;this.mergeFeeds();}.bind(this),4);}};NYTD.Facebook.Module=(function(){var recommendationsEl=new Element("div"),activitiesEl=new Element("div"),headerEl=new Element("div");var info="Throughout NYTimes.com, you will see Facebook modules like this one. Log in with Facebook to see what your friends are recommending and make your own recommendations. For details, click &ldquo;What&rsquo;s This?&rdquo; to open the Social Media FAQ.";function activateFacebookButton(){$$(".fb_button").invoke("observe","click",function(event){NYTD.Facebook.User.login();});}function appendTrackingToURL(url,trackingSrc){var retStr=url;if(retStr.indexOf("?")!==-1){retStr+="&";}else{retStr+="?";}retStr+="src="+trackingSrc;return retStr;}return{renderLoggedIn:function(){var container=$("facebookContainer");if(container){var inset=new Element("div").addClassName(NYTD.Facebook.ArticleModuleView?"":"inset");headerEl.update(this.templates.loggedInHeader);inset.insert(headerEl);inset.insert(this.templates.faq);inset.insert(activitiesEl);inset.insert(recommendationsEl);container.removeClassName("loggedOut");container.addClassName("loggedIn");container.update(inset);}},renderLoggedOut:function(){var container=$("facebookContainer");if(container){var inset=new Element("div").addClassName("inset");inset.insert(this.templates.login);headerEl.update(this.templates.loggedOutHeader);inset.insert(headerEl);inset.insert(recommendationsEl);container.removeClassName("loggedIn");container.addClassName("loggedOut");container.update(inset);activateFacebookButton();}},updateNetwork:function(activities){var buffer=new Element("div");for(var i=0,activity;activity=activities[i];i++){activity.url=appendTrackingToURL(activity.url,this.TRACKING_NETWORK);var item=NYTD.Template(this.templates.activity,activity);buffer.insert(item);}activitiesEl.update(buffer.innerHTML);},updateRecommendations:function(activities){recommendationsEl.removeClassName("subColumns").removeClassName("subColumn-2");var buffer=new Element("div");for(var i=0,activity;activity=activities[i];i++){activity.url=appendTrackingToURL(activity.url,this.TRACKING_RECOMMENDATION);activity.img=activity.thumbnail||activity.img;var item=NYTD.Template(this.templates.recommendation,activity);buffer.insert(item);}recommendationsEl.update(buffer.innerHTML);},updatePopular:function(activities){recommendationsEl.addClassName("subColumns").addClassName("subColumn-2");var buffer=new Element("div");for(var i=0,activity;activity=activities[i];i++){activity.url=appendTrackingToURL(activity.url,this.TRACKING_POPULAR);activity.img=activity.thumbnail||activity.img;var item;if(NYTD.Facebook.ArticleModuleView){item='<div class="column '+(i%2?"last":"")+'">'+NYTD.Template(this.templates.popular,activity)+"</div>";}else{item=NYTD.Template(this.templates.popular,activity);}buffer.insert(item);}recommendationsEl.update(buffer.innerHTML);},setHeader:function(header){headerEl.down("h4").update(header);},templates:{login:'        <a class="fb_button fb_button_medium">          <span class="fb_button_text">Log In With Facebook</span>        </a>        <p class="caption">Log in to see what your friends are sharing on nytimes.com.        <span id="fbInfo"><a href="http://www.nytimes.com/privacy">Privacy Policy</a> | <a href="http://www.nytimes.com/packages/html/timespeople/faq/social/" title="'+info+'">What&rsquo;s This?</a></span></p>        <div class="singleRuleDivider"></div>      ',loggedOutHeader:'<h4 class="sectionHeaderHome">What&rsquo;s Popular Now <img class="inTextImage" src="'+NYTD.Hosts.imageHost+'/images/article/functions/facebook.gif"></h4>',loggedInHeader:'<h4 class="sectionHeaderHome">Latest in My Network <img class="inTextImage" src="'+NYTD.Hosts.imageHost+'/images/article/functions/facebook.gif"></h4>',activity:'        <div class="activity">          <% if (user.image) { %>            <img class="userImage" height="25" width="25" src="<%= user.image %>" />          <% } %>          <div class="actor">            <a href="<%= user.href %>"><%= user.name %></a>            <span class="verb"> recommended </span>           </div>           <p><a href="<%= url %>"><%= title %></a></p>        </div>',recommendation:'        <div class="activity">          <div class="verb">Popular Now</div>          <p><a href="<%= url %>"><%= title %></a></p>        </div>',popular:'          <div class="activity">            <% if (img) { %>              <img class="runaroundRight" height="50" width="50" src="<%= img %>" />            <% } %>            <p class="popular"><a href="<%= url %>"><%= title %></a></p>          </div>',faq:'<div id="fbInfo"><a class="meta" href="http://www.nytimes.com/packages/html/timespeople/faq/social/" title="'+info+'">What&rsquo;s This?</a></div>'}};})();$$("head").first().insert(new Element("link",{"rel":"stylesheet","type":"text/css","href":NYTD.Hosts.cssHost+"/css/app/facebook/newsletterPrefs.css"}));NYTD.Facebook.PrefsDialog=(function(){function setEventHandlers(){Event.observe($("facebookNewsletterForm"),"submit",function(e){var queryString=e.element().serialize();NYTD.Facebook.User.setEmailFormat(queryString);NYTD.UPTracker&&NYTD.UPTracker.track({"eventType":"es","data":{"name":"nytupdates","src":"MPS-FBM"}});NYTD.Facebook.PrefsDialog.close();e.stop();});Event.observe($("facebookNewsletterForm"),"reset",function(e){NYTD.Facebook.PrefsDialog.close();e.stop();});}return{element:new Element("div"),open:function(){this.element.update(this.template);document.body.appendChild(this.element);this.open=null;setEventHandlers();},close:function(){this.element.remove();},template:'  <div id="facebookModalBg">    <div id="facebookModal">      <div class="facebookModalBar facebookModalBarTop">&nbsp;</div>      <form id="facebookNewsletterForm">      <div class="facebookModalInner">      <p class="facebookModalText">Thanks for logging in with Facebook and creating an NYTimes.com account!</h1>      <p><strong>Sign up for e-mails from NYTimes.com, exclusively for registered users:</strong></p>      <table cellspacing="0">      <tr>      <td><p>Preferred E-Mail Format:</p></td>      <td>      <label><input type="radio" name="email_format" value="html" checked="checked"></input> HTML (Text and Images)</label>      <label><input type="radio" name="email_format" value="text"></input> Text Only</label>      </td>      </tr>      </table>      </div>      <div class="facebookModalBar">        <div class="inset">        <button type="submit" class="appButton" name="facebookNewsletterSubscribe" value="yes"><span>Yes!</span></button>&nbsp;&nbsp;        <button type="reset" class="appButton" name="facebookNewsletterSubscribe" value="no"><span>No Thanks.</span></button>        </div>      </div>      </div>    </div>  </div>  '};})();$$("head").first().insert(new Element("link",{"rel":"stylesheet","type":"text/css","href":NYTD.Hosts.cssHost+"/css/app/facebook/homepage.css"}));NYTD.Facebook.HomepageModuleView=NYTD.Facebook.Module;NYTD.Facebook.HomepageModuleView.TRACKING_NETWORK="ISMR_HP_LI_LST_FB";NYTD.Facebook.HomepageModuleView.TRACKING_RECOMMENDATION="ISMR_HP_LI_MST_FB";NYTD.Facebook.HomepageModuleView.TRACKING_POPULAR="ISMR_HP_LO_MST_FB";NYTD.Facebook.HomepageController=Object.create(NYTD.Facebook.BaseController);NYTD.Facebook.HomepageController.view=NYTD.Facebook.HomepageModuleView;NYTD.Facebook.HomepageController.patch=function(){if(typeof no_facebook_module!="undefined"){return;}var toolsHome;var cColumnTopSpanRegion=$("cColumnTopSpanRegion");var lastColumn=cColumnTopSpanRegion&&cColumnTopSpanRegion.select(".lastColumn").first();if(cColumnTopSpanRegion&&lastColumn){var lastColumnContent=lastColumn.select(".columnGroup").first();lastColumn.previous(".column").appendChild(lastColumnContent);var holder=new Element("div",{"id":"facebookContainer"});lastColumn.appendChild(holder);var moduleHeight=$("cColumnTopSpanRegion").offsetHeight;moduleHeight+=8;holder.style.minHeight=moduleHeight+"px";NYTD.Facebook.User.register(this.render.bind(this));NYTD.Facebook.User.isLoggedIn();}else{setTimeout(this.patch.bind(this),10);}};if(window.XMLHttpRequest){(function(){var meta=document.getElementsByName("PST")[0];if(meta&&meta.content=="Global Edition"){return;}window.fbAsyncInit=function(){NYTD.Facebook.HomepageController.run();};NYTD.Facebook.SDK.load();})();}(function(){NYTD.EditionPref={};NYTD.EditionPref.setGlobal=function(){var cookie=NYTD.Cookies.getOrCreate("NYT-Edition");cookie.add({"edition":"GLOBAL"});};NYTD.EditionPref.setUS=function(){var cookie=NYTD.Cookies.getOrCreate("NYT-Edition");cookie.add({"edition":"US"});};}());function onTemplateLoaded(experienceId){var experienceObject=brightcove.getExperience(experienceId);var videoModule=experienceObject.getModule(APIModules.VIDEO_PLAYER);videoModule.setConnectOnLoad(false);switch(experienceId){case"timescastVideoPlayerObj":NYTD.TimesCastManager.initialize();break;case"channelPlayer":NYTD.HPChannelPlayer.initialize();break;}}
// Wed Jul 13 18:35:28 EDT 2011
